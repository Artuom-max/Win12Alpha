<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 12</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            overflow: hidden;
            user-select: none;
            background: #000;
        }

        /* ============ ANIMATED BACKGROUNDS ============ */
        .bg-animated-gradient {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bg-animated-aurora {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 75%, #16213e 100%);
            background-size: 400% 400%;
            animation: aurora 20s ease infinite;
        }

        @keyframes aurora {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 50% 0%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 100%; }
        }

        .bg-animated-waves {
            background: linear-gradient(180deg, #0077b6 0%, #00b4d8 30%, #90e0ef 60%, #caf0f8 100%);
            position: relative;
            overflow: hidden;
        }

        .bg-animated-waves::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at center bottom, rgba(255,255,255,0.3) 0%, transparent 60%);
            animation: waves 8s ease-in-out infinite;
        }

        @keyframes waves {
            0%, 100% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(5%) translateY(-3%); }
        }

        .bg-animated-particles {
            background: #0f0f23;
            position: relative;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            animation: float 15s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        .bg-animated-matrix {
            background: #000;
            position: relative;
            overflow: hidden;
        }

        .matrix-column {
            position: absolute;
            top: -100%;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #0f0;
            text-shadow: 0 0 5px #0f0;
            animation: matrix 10s linear infinite;
            opacity: 0.7;
        }

        @keyframes matrix {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(200vh); }
        }

        /* Video background */
        .bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Custom image background */
        .bg-custom-image {
            background-size: cover;
            background-position: center;
        }

        /* ============ BIOS ============ */
        #bios-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0000aa;
            display: none;
            z-index: 20000;
            padding: 20px;
            font-family: 'Consolas', monospace;
        }

        .bios-header {
            text-align: center;
            color: #fff;
            padding: 15px;
            background: #00aaaa;
            margin: -20px -20px 20px -20px;
        }

        .bios-content { display: flex; gap: 20px; height: calc(100% - 120px); }

        .bios-menu {
            width: 220px;
            background: #000080;
            border: 2px solid #aaa;
        }

        .bios-menu-title {
            background: #00aaaa;
            color: #000;
            padding: 5px 10px;
            font-weight: bold;
        }

        .bios-menu-item {
            padding: 8px 12px;
            color: #fff;
            cursor: pointer;
        }

        .bios-menu-item:hover { background: #0000cc; }
        .bios-menu-item.selected { background: #aaa; color: #000; }
        .bios-menu-item.danger { color: #ff6666; }

        .bios-main {
            flex: 1;
            background: #000080;
            border: 2px solid #aaa;
            padding: 15px;
            color: #fff;
        }

        .bios-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #00aaaa;
            color: #000;
            padding: 8px 20px;
            font-size: 12px;
        }

        .bios-confirm {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #000080;
            border: 3px solid #fff;
            padding: 25px;
            z-index: 20001;
            display: none;
            text-align: center;
            color: #fff;
        }

        /* ============ BOOT ============ */
        #boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .windows-logo {
            width: 80px;
            height: 80px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            animation: pulse 2s infinite;
        }

        .windows-logo div { background: #0078d4; }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        .boot-loader {
            margin-top: 40px;
            display: flex;
            gap: 6px;
        }

        .boot-loader div {
            width: 8px;
            height: 8px;
            background: #0078d4;
            border-radius: 50%;
            animation: loader 1.2s infinite;
        }

        .boot-loader div:nth-child(2) { animation-delay: 0.15s; }
        .boot-loader div:nth-child(3) { animation-delay: 0.3s; }
        .boot-loader div:nth-child(4) { animation-delay: 0.45s; }
        .boot-loader div:nth-child(5) { animation-delay: 0.6s; }

        @keyframes loader {
            0%, 100% { transform: translateY(0); opacity: 0.3; }
            50% { transform: translateY(-12px); opacity: 1; }
        }

        .boot-hint {
            position: absolute;
            bottom: 40px;
            color: #555;
            font-size: 13px;
        }

        /* ============ SETUP ============ */
        #setup-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 9000;
            overflow: hidden;
        }

        .setup-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: all 0.5s ease;
        }

        .setup-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            z-index: 1;
        }

        .setup-left {
            width: 35%;
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: #fff;
        }

        .setup-left h1 {
            font-size: 38px;
            font-weight: 300;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .setup-left p {
            opacity: 0.8;
            line-height: 1.5;
            text-shadow: 0 1px 5px rgba(0,0,0,0.3);
        }

        .setup-right {
            width: 65%;
            background: rgba(255,255,255,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 25px 0 0 25px;
            backdrop-filter: blur(20px);
        }

        .setup-form {
            width: 420px;
            padding: 35px;
        }

        .setup-step {
            display: none;
            animation: stepFade 0.4s ease;
        }

        .setup-step.active { display: block; }

        @keyframes stepFade {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .setup-step h2 {
            color: #1a1a2e;
            font-size: 26px;
            margin-bottom: 8px;
        }

        .setup-step h3 {
            color: #666;
            font-size: 13px;
            margin-bottom: 25px;
            font-weight: normal;
        }

        .form-group { margin-bottom: 20px; }

        .form-group label {
            display: block;
            color: #333;
            font-size: 13px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.2s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #0078d4;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s;
        }

        .progress-dot.active { background: #0078d4; transform: scale(1.2); }
        .progress-dot.completed { background: #00c853; }

        /* Theme selector */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 10px;
        }

        .theme-card {
            aspect-ratio: 16/10;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .theme-card:hover { transform: scale(1.05); }
        .theme-card.selected { border-color: #0078d4; box-shadow: 0 4px 15px rgba(0,120,212,0.4); }

        .theme-card span {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 10px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            white-space: nowrap;
        }

        .theme-card .animated-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ff5722;
            color: #fff;
            font-size: 8px;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .setup-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0078d4, #00a8e8);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,120,212,0.3);
        }

        .btn-secondary { background: #f0f0f0; color: #333; }
        .btn-secondary:hover { background: #e0e0e0; }

        /* ============ LOGIN ============ */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 8000;
        }

        .login-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .login-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.25);
        }

        .login-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        .login-time {
            color: #fff;
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 0 2px 15px rgba(0,0,0,0.4);
        }

        .login-time .time { font-size: 86px; font-weight: 300; }
        .login-time .date { font-size: 22px; opacity: 0.9; }

        .login-box { text-align: center; cursor: pointer; }

        .user-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 0 auto 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            color: #fff;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .user-name {
            color: #fff;
            font-size: 24px;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .password-container { display: none; }
        .password-container.show { display: block; animation: slideUp 0.3s ease; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .password-field {
            display: flex;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 2px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }

        .password-field input {
            width: 250px;
            padding: 14px 22px;
            border: none;
            background: transparent;
            color: #fff;
            font-size: 15px;
            outline: none;
        }

        .password-field input::placeholder { color: rgba(255,255,255,0.6); }

        .password-submit {
            padding: 14px 22px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
        }

        .password-submit:hover { background: rgba(255,255,255,0.3); }

        .login-error {
            color: #ff6b6b;
            margin-top: 12px;
            display: none;
            font-size: 13px;
        }

        .click-hint {
            color: rgba(255,255,255,0.7);
            font-size: 13px;
            margin-top: 8px;
        }

        /* ============ LOADING ============ */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 11000;
            flex-direction: column;
        }

        .loading-text { color: #fff; margin-top: 25px; font-size: 16px; }

        /* ============ DESKTOP ============ */
        #desktop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }

        .desktop-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #desktop-area {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 55px;
        }

        .desktop-icon {
            position: absolute;
            width: 76px;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
        }

        .desktop-icon:hover { background: rgba(255,255,255,0.1); }
        .desktop-icon.selected { background: rgba(0,120,212,0.4); border: 1px solid rgba(0,120,212,0.7); }
        .desktop-icon.dragging { opacity: 0.5; }

        .desktop-icon .icon-img {
            width: 44px;
            height: 44px;
            margin: 0 auto 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
        }

        .desktop-icon span {
            color: #fff;
            font-size: 11px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            display: block;
            word-wrap: break-word;
            line-height: 1.2;
        }

        .desktop-icon input {
            width: 100%;
            background: rgba(0,0,0,0.8);
            border: 1px solid #0078d4;
            border-radius: 3px;
            text-align: center;
            font-size: 11px;
            padding: 3px;
            color: #fff;
            outline: none;
        }

        #selection-box {
            position: absolute;
            border: 1px solid #0078d4;
            background: rgba(0,120,212,0.2);
            pointer-events: none;
            display: none;
            z-index: 50;
        }

        /* ============ TASKBAR ============ */
        .taskbar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 52px;
            background: rgba(30, 30, 30, 0.85);
            backdrop-filter: blur(30px);
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.08);
            z-index: 100;
        }

        .taskbar-center {
            display: flex;
            gap: 4px;
            background: rgba(255,255,255,0.05);
            padding: 4px;
            border-radius: 10px;
        }

        .taskbar-item {
            width: 44px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
        }

        .taskbar-item:hover { background: rgba(255,255,255,0.1); }

        .taskbar-item.active::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 18px;
            height: 3px;
            background: #0078d4;
            border-radius: 2px;
        }

        .taskbar-item svg { width: 22px; height: 22px; fill: #fff; }

        .taskbar-left, .taskbar-right {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .taskbar-left { left: 12px; }
        .taskbar-right { right: 12px; }

        .weather-widget {
            color: #fff;
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
        }

        .weather-widget:hover { background: rgba(255,255,255,0.1); }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
        }

        .system-tray:hover { background: rgba(255,255,255,0.1); }
        .system-tray svg { width: 16px; height: 16px; fill: #fff; }

        .clock {
            color: #fff;
            font-size: 12px;
            text-align: right;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
        }

        .clock:hover { background: rgba(255,255,255,0.1); }
        .clock-time { font-weight: 500; }
        .clock-date { font-size: 10px; opacity: 0.7; }

        /* ============ START MENU ============ */
        #start-menu {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%) scale(0.95);
            width: 600px;
            max-height: 650px;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(40px);
            border-radius: 14px;
            display: none;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            opacity: 0;
            z-index: 200;
        }

        #start-menu.show {
            display: flex;
            opacity: 1;
            transform: translateX(-50%) scale(1);
            animation: menuOpen 0.2s ease;
        }

        @keyframes menuOpen {
            from { opacity: 0; transform: translateX(-50%) scale(0.95) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) scale(1) translateY(0); }
        }

        .start-search { padding: 18px; }

        .start-search input {
            width: 100%;
            padding: 10px 18px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            color: #fff;
            font-size: 13px;
            outline: none;
        }

        .start-section { padding: 0 18px 12px; }
        .start-section h3 { color: #fff; font-size: 13px; margin-bottom: 10px; }

        .pinned-apps {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
        }

        .app-tile {
            padding: 10px 6px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
        }

        .app-tile:hover { background: rgba(255,255,255,0.1); }

        .app-tile .app-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 5px;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }

        .app-tile span { color: #fff; font-size: 10px; }

        .start-footer {
            padding: 12px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .start-user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        .start-user:hover { background: rgba(255,255,255,0.1); }

        .start-user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 14px;
        }

        .start-user span { color: #fff; font-size: 13px; }

        .power-btn {
            width: 36px;
            height: 36px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .power-btn:hover { background: rgba(255,255,255,0.1); }
        .power-btn svg { width: 18px; height: 18px; fill: #fff; }

        /* ============ WINDOWS ============ */
        .window {
            position: absolute;
            background: rgba(30, 30, 30, 0.98);
            backdrop-filter: blur(30px);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            display: none;
            flex-direction: column;
            min-width: 280px;
            min-height: 180px;
            overflow: hidden;
            z-index: 100;
        }

        .window.active { z-index: 150; box-shadow: 0 20px 70px rgba(0,0,0,0.6); }

        .window-header {
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            background: rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .window-title { color: #fff; font-size: 12px; display: flex; align-items: center; gap: 8px; }

        .window-controls { display: flex; gap: 6px; }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .window-control:hover { transform: scale(1.15); }
        .window-control.close { background: #ff5f57; }
        .window-control.minimize { background: #ffbd2e; }
        .window-control.maximize { background: #28c840; }

        .window-content { flex: 1; overflow: hidden; color: #fff; display: flex; flex-direction: column; }

        .window-resize {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 14px;
            height: 14px;
            cursor: nwse-resize;
        }

        /* ============ BROWSER ============ */
        #browser-window { width: 1050px; height: 700px; top: 25px; left: 70px; }

        .browser-tabs {
            display: flex;
            align-items: center;
            gap: 2px;
            padding: 6px 8px 0;
            background: rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .browser-tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 7px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            color: #fff;
            font-size: 11px;
            max-width: 160px;
        }

        .browser-tab.active { background: rgba(255,255,255,0.1); }
        .browser-tab-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .browser-tab-close {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 12px;
        }

        .browser-tab-close:hover { background: rgba(255,255,255,0.2); }

        .browser-new-tab {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            color: #fff;
            font-size: 16px;
        }

        .browser-new-tab:hover { background: rgba(255,255,255,0.1); }

        .browser-toolbar {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .browser-nav-btn {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            color: #fff;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
        }

        .browser-nav-btn:hover { background: rgba(255,255,255,0.1); }
        .browser-nav-btn:disabled { opacity: 0.3; }

        .browser-url-bar {
            flex: 1;
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 0 12px;
        }

        .browser-url-bar .lock { font-size: 12px; margin-right: 8px; }

        .browser-url {
            flex: 1;
            padding: 8px 0;
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            font-size: 13px;
        }

        .browser-content { flex: 1; background: #fff; overflow: hidden; }

        .browser-iframe { width: 100%; height: 100%; border: none; }

        .browser-home {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .browser-logo { font-size: 42px; margin-bottom: 25px; color: #0078d4; }

        .browser-search-box {
            width: 550px;
            display: flex;
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .browser-search-box input {
            flex: 1;
            padding: 14px 22px;
            border: none;
            font-size: 15px;
            outline: none;
        }

        .browser-search-box button {
            padding: 14px 22px;
            background: #0078d4;
            border: none;
            color: #fff;
            cursor: pointer;
        }

        .browser-shortcuts {
            display: flex;
            gap: 16px;
            margin-top: 35px;
        }

        .browser-shortcut {
            width: 80px;
            text-align: center;
            cursor: pointer;
            padding: 12px;
            border-radius: 10px;
        }

        .browser-shortcut:hover { background: rgba(0,0,0,0.05); }

        .browser-shortcut-icon {
            width: 44px;
            height: 44px;
            margin: 0 auto 6px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: #f0f0f0;
        }

        .browser-shortcut span { color: #333; font-size: 11px; }

        /* ============ SETTINGS ============ */
        #settings-window { width: 900px; height: 620px; top: 35px; left: 90px; }

        .settings-layout { display: flex; height: 100%; }

        .settings-sidebar {
            width: 230px;
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .settings-nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .settings-nav-item:hover { background: rgba(255,255,255,0.1); }
        .settings-nav-item.active { background: rgba(0,120,212,0.3); }

        .settings-main {
            flex: 1;
            padding: 20px 25px;
            overflow-y: auto;
        }

        .settings-main h2 { font-size: 26px; margin-bottom: 18px; font-weight: 300; }

        .setting-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .setting-item {
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .setting-item:last-child { border-bottom: none; }
        .setting-item-info h4 { font-size: 13px; margin-bottom: 2px; font-weight: 400; }
        .setting-item-info p { font-size: 11px; color: rgba(255,255,255,0.5); }

        .setting-item input, .setting-item select {
            padding: 7px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            color: #fff;
            outline: none;
            font-size: 13px;
        }

        .toggle-switch {
            width: 42px;
            height: 22px;
            background: rgba(255,255,255,0.2);
            border-radius: 11px;
            cursor: pointer;
            position: relative;
        }

        .toggle-switch.active { background: #0078d4; }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.2s;
        }

        .toggle-switch.active::after { left: 22px; }

        .btn-small {
            padding: 7px 14px;
            background: #0078d4;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-small:hover { background: #106ebe; }

        /* Wallpaper grid */
        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 12px;
        }

        .wallpaper-item {
            aspect-ratio: 16/10;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .wallpaper-item:hover { transform: scale(1.03); }
        .wallpaper-item.selected { border-color: #0078d4; }

        .wallpaper-item span {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 9px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        .wallpaper-item .badge {
            position: absolute;
            top: 3px;
            right: 3px;
            background: #ff5722;
            color: #fff;
            font-size: 7px;
            padding: 2px 4px;
            border-radius: 2px;
        }

        .custom-wallpaper-drop {
            aspect-ratio: 16/10;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-wallpaper-drop:hover { border-color: #0078d4; background: rgba(0,120,212,0.1); }
        .custom-wallpaper-drop.dragover { border-color: #0078d4; background: rgba(0,120,212,0.2); }
        .custom-wallpaper-drop span { font-size: 24px; margin-bottom: 5px; }
        .custom-wallpaper-drop p { font-size: 10px; color: rgba(255,255,255,0.6); }

        /* ============ EXPLORER ============ */
        #explorer-window { width: 900px; height: 560px; top: 55px; left: 110px; }

        .explorer-toolbar {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .explorer-toolbar button {
            background: transparent;
            border: none;
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .explorer-toolbar button:hover { background: rgba(255,255,255,0.1); }
        .explorer-toolbar button:disabled { opacity: 0.3; }

        .explorer-path {
            flex: 1;
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 12px;
        }

        .explorer-body { display: flex; flex: 1; overflow: hidden; }

        .explorer-sidebar {
            width: 180px;
            padding: 8px;
            border-right: 1px solid rgba(255,255,255,0.1);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .explorer-sidebar-title {
            color: rgba(255,255,255,0.5);
            font-size: 10px;
            padding: 6px 8px;
            text-transform: uppercase;
        }

        .explorer-sidebar-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 7px 8px;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            font-size: 12px;
        }

        .explorer-sidebar-item:hover { background: rgba(255,255,255,0.1); }
        .explorer-sidebar-item.active { background: rgba(0,120,212,0.3); }

        .explorer-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            position: relative;
        }

        .explorer-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
        }

        .explorer-item {
            width: 85px;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
        }

        .explorer-item:hover { background: rgba(255,255,255,0.1); }
        .explorer-item.selected { background: rgba(0,120,212,0.3); }
        .explorer-item.locked { opacity: 0.5; }

        .explorer-item .item-icon { font-size: 36px; margin-bottom: 4px; }
        .explorer-item .item-name { font-size: 10px; color: #fff; word-wrap: break-word; line-height: 1.2; }

        .explorer-item .lock-icon {
            position: absolute;
            bottom: 22px;
            right: 8px;
            font-size: 10px;
        }

        .explorer-empty {
            color: rgba(255,255,255,0.4);
            text-align: center;
            padding: 30px;
            font-size: 13px;
        }

        .explorer-statusbar {
            padding: 5px 12px;
            background: rgba(0,0,0,0.2);
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            flex-shrink: 0;
        }

        /* ============ NOTEPAD ============ */
        #notepad-window { width: 650px; height: 450px; top: 70px; left: 150px; }

        .notepad-textarea {
            flex: 1;
            background: #1e1e1e;
            border: none;
            color: #d4d4d4;
            padding: 12px;
            font-family: 'Cascadia Code', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.4;
            resize: none;
            outline: none;
        }

        .notepad-statusbar {
            padding: 4px 12px;
            background: rgba(0,0,0,0.3);
            font-size: 11px;
            color: rgba(255,255,255,0.4);
            flex-shrink: 0;
        }

        /* ============ MEDIA PLAYER ============ */
        #player-window { width: 750px; height: 500px; top: 60px; left: 160px; }

        .player-content { flex: 1; display: flex; flex-direction: column; background: #000; }

        .player-display {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .player-display video, .player-display audio { max-width: 100%; max-height: 100%; }

        .player-dropzone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-align: center;
            width: 100%;
            height: 100%;
        }

        .player-dropzone.dragover { background: rgba(0,120,212,0.3); }
        .player-dropzone .drop-icon { font-size: 70px; margin-bottom: 15px; opacity: 0.4; }
        .player-dropzone h3 { margin-bottom: 8px; font-weight: 400; }
        .player-dropzone p { opacity: 0.5; font-size: 13px; }

        .player-controls {
            padding: 12px 16px;
            background: rgba(25,25,25,0.95);
            flex-shrink: 0;
        }

        .player-progress {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .player-progress-bar { height: 100%; background: #0078d4; border-radius: 2px; width: 0%; }

        .player-buttons { display: flex; align-items: center; gap: 12px; }

        .player-btn {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            padding: 6px;
            border-radius: 50%;
        }

        .player-btn:hover { background: rgba(255,255,255,0.1); }
        .player-btn.play { font-size: 28px; }

        .player-time { color: rgba(255,255,255,0.6); font-size: 12px; min-width: 90px; }

        .player-info { flex: 1; text-align: center; }
        .player-info .title { color: #fff; font-size: 13px; }

        .player-volume { display: flex; align-items: center; gap: 8px; }

        .player-volume input {
            width: 80px;
            height: 3px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }

        .player-volume input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        /* ============ RECYCLE BIN ============ */
        #recycle-window { width: 650px; height: 450px; top: 85px; left: 180px; }

        .recycle-toolbar {
            display: flex;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .recycle-toolbar button {
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .recycle-toolbar button:hover { background: rgba(255,255,255,0.15); }
        .recycle-toolbar button:disabled { opacity: 0.4; cursor: not-allowed; }

        .recycle-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
        }

        .recycle-item {
            width: 85px;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0.7;
        }

        .recycle-item:hover { background: rgba(255,255,255,0.1); }
        .recycle-item.selected { background: rgba(0,120,212,0.3); }
        .recycle-item .item-icon { font-size: 36px; margin-bottom: 4px; }
        .recycle-item .item-name { font-size: 10px; color: #fff; }

        /* ============ CALCULATOR ============ */
        #calculator-window { width: 300px; height: 440px; top: 90px; left: 280px; }

        .calc-display { padding: 20px 16px; text-align: right; background: rgba(0,0,0,0.3); }
        .calc-expression { color: rgba(255,255,255,0.4); font-size: 13px; min-height: 18px; }
        .calc-result { color: #fff; font-size: 38px; font-weight: 300; }

        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; flex: 1; }

        .calc-btn {
            background: rgba(255,255,255,0.05);
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        .calc-btn:hover { background: rgba(255,255,255,0.1); }
        .calc-btn.op { background: rgba(255,255,255,0.08); }
        .calc-btn.eq { background: #0078d4; }
        .calc-btn.eq:hover { background: #106ebe; }

        /* ============ CONTEXT MENU ============ */
        #context-menu, #icon-context-menu {
            position: absolute;
            width: 240px;
            background: rgba(35, 35, 35, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 5px;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
        }

        .ctx-item {
            padding: 8px 12px;
            color: #fff;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ctx-item:hover { background: rgba(255,255,255,0.1); }
        .ctx-item.disabled { opacity: 0.4; pointer-events: none; }
        .ctx-item .icon { width: 18px; text-align: center; }
        .ctx-item .key { margin-left: auto; color: rgba(255,255,255,0.3); font-size: 10px; }

        .ctx-divider { height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0; }

        /* ============ NOTIFICATION ============ */
        .notification {
            position: fixed;
            bottom: 65px;
            right: 15px;
            background: rgba(35, 35, 35, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            padding: 12px 16px;
            min-width: 280px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            z-index: 10000;
            animation: notifIn 0.25s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        @keyframes notifIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .notification-header h4 { color: #fff; font-size: 13px; font-weight: 500; }
        .notification-close { color: rgba(255,255,255,0.4); cursor: pointer; font-size: 16px; }
        .notification-body { color: rgba(255,255,255,0.7); font-size: 12px; }

        /* ============ INPUT DIALOG ============ */
        #dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
        }

        #input-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(35, 35, 35, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 10px;
            padding: 22px;
            min-width: 320px;
            z-index: 10001;
            display: none;
            border: 1px solid rgba(255,255,255,0.1);
        }

        #input-dialog h3 { color: #fff; margin-bottom: 12px; font-weight: 400; font-size: 15px; }

        #input-dialog input {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            outline: none;
            margin-bottom: 16px;
        }

        #input-dialog input:focus { border-color: #0078d4; }

        #input-dialog .dialog-buttons { display: flex; justify-content: flex-end; gap: 8px; }

        #input-dialog button {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
        }

        #input-dialog .btn-cancel { background: rgba(255,255,255,0.1); color: #fff; }
        #input-dialog .btn-ok { background: #0078d4; color: #fff; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }
    </style>
</head>
<body>
    <!-- BIOS -->
    <div id="bios-screen">
        <div class="bios-header">
            <h1>BIOS Setup Utility</h1>
        </div>
        <div class="bios-content">
            <div class="bios-menu">
                <div class="bios-menu-title">Menu</div>
                <div class="bios-menu-item selected" data-section="info"> System Info</div>
                <div class="bios-menu-item danger" data-section="recovery"> Recovery Reset</div>
                <div class="bios-menu-item" data-section="exit"> Save & Exit</div>
            </div>
            <div class="bios-main" id="bios-main"></div>
        </div>
        <div class="bios-footer">ESC - Exit |  - Select | Enter - Confirm</div>
    </div>

    <div class="bios-confirm" id="bios-confirm">
        <h3 style="color: #ff6; margin-bottom: 12px;"> Recovery Reset</h3>
        <p style="margin-bottom: 18px;">Reset all settings to default?</p>
        <button onclick="doRecovery()" style="padding: 6px 18px; background: #a00; color: #fff; border: 2px solid #fff; cursor: pointer; margin-right: 8px;">Yes</button>
        <button onclick="cancelRecovery()" style="padding: 6px 18px; background: #080; color: #fff; border: 2px solid #fff; cursor: pointer;">No</button>
    </div>

    <!-- Boot -->
    <div id="boot-screen">
        <div class="windows-logo"><div></div><div></div><div></div><div></div></div>
        <div class="boot-loader"><div></div><div></div><div></div><div></div><div></div></div>
        <p class="boot-hint">Press DELETE 5 times for BIOS</p>
    </div>

    <!-- Setup -->
    <div id="setup-screen">
        <div class="setup-bg" id="setup-bg"></div>
        <div class="setup-container">
            <div class="setup-left">
                <h1 id="setup-title">Windows 12</h1>
                <p id="setup-desc">Let's set up your system.</p>
            </div>
            <div class="setup-right">
                <div class="setup-form">
                    <!-- Step 1: Language -->
                    <div class="setup-step active" data-step="1">
                        <div class="progress-dots">
                            <div class="progress-dot active"></div>
                            <div class="progress-dot"></div>
                            <div class="progress-dot"></div>
                            <div class="progress-dot"></div>
                        </div>
                        <h2 data-i18n="setup_lang_title">Language</h2>
                        <h3 data-i18n="setup_lang_desc">Choose your language</h3>
                        <div class="form-group">
                            <select id="setup-language" onchange="changeLanguage(this.value)">
                                <option value="ru"> </option>
                                <option value="en"> English</option>
                            </select>
                        </div>
                        <div class="setup-nav">
                            <div></div>
                            <button class="btn btn-primary" onclick="nextSetupStep()" data-i18n="next">Next </button>
                        </div>
                    </div>

                    <!-- Step 2: Account -->
                    <div class="setup-step" data-step="2">
                        <div class="progress-dots">
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot active"></div>
                            <div class="progress-dot"></div>
                            <div class="progress-dot"></div>
                        </div>
                        <h2 data-i18n="setup_account_title">Account</h2>
                        <h3 data-i18n="setup_account_desc">Create your user</h3>
                        <div class="form-group">
                            <label data-i18n="username">Username</label>
                            <input type="text" id="setup-username" value="Artuom">
                        </div>
                        <div class="form-group">
                            <label data-i18n="password">Password</label>
                            <input type="password" id="setup-password" value="1286">
                        </div>
                        <div class="form-group">
                            <label data-i18n="confirm_password">Confirm Password</label>
                            <input type="password" id="setup-password2" value="1286">
                        </div>
                        <div class="setup-nav">
                            <button class="btn btn-secondary" onclick="prevSetupStep()" data-i18n="back"> Back</button>
                            <button class="btn btn-primary" onclick="nextSetupStep()" data-i18n="next">Next </button>
                        </div>
                    </div>

                    <!-- Step 3: Theme -->
                    <div class="setup-step" data-step="3">
                        <div class="progress-dots">
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot active"></div>
                            <div class="progress-dot"></div>
                        </div>
                        <h2 data-i18n="setup_theme_title">Theme</h2>
                        <h3 data-i18n="setup_theme_desc">Choose your wallpaper</h3>
                        <div class="theme-grid" id="theme-grid"></div>
                        <div class="setup-nav">
                            <button class="btn btn-secondary" onclick="prevSetupStep()" data-i18n="back"> Back</button>
                            <button class="btn btn-primary" onclick="nextSetupStep()" data-i18n="next">Next </button>
                        </div>
                    </div>

                    <!-- Step 4: Summary -->
                    <div class="setup-step" data-step="4">
                        <div class="progress-dots">
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot active"></div>
                        </div>
                        <h2 data-i18n="setup_ready_title">Ready!</h2>
                        <h3 data-i18n="setup_ready_desc">Review your settings</h3>
                        <div style="background: #f5f5f5; padding: 16px; border-radius: 10px; color: #333; font-size: 13px;">
                            <p id="summary-user" style="margin-bottom: 6px;"> User: Artuom</p>
                            <p id="summary-lang" style="margin-bottom: 6px;"> Language: </p>
                            <p id="summary-theme"> Theme: Light</p>
                        </div>
                        <div class="setup-nav">
                            <button class="btn btn-secondary" onclick="prevSetupStep()" data-i18n="back"> Back</button>
                            <button class="btn btn-primary" onclick="finishSetup()" data-i18n="finish">Finish </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login -->
    <div id="login-screen">
        <div class="login-bg" id="login-bg"></div>
        <div class="login-overlay"></div>
        <div class="login-content">
            <div class="login-time">
                <div class="time" id="login-time">12:00</div>
                <div class="date" id="login-date">January 1</div>
            </div>
            <div class="login-box" onclick="showPasswordBox()">
                <div class="user-avatar" id="login-avatar">A</div>
                <div class="user-name" id="login-name">Artuom</div>
                <p class="click-hint" id="click-hint" data-i18n="click_to_login">Click to sign in</p>
                <div class="password-container" id="password-box">
                    <div class="password-field">
                        <input type="password" id="login-password" data-i18n-placeholder="password" placeholder="Password" onkeydown="if(event.key==='Enter')attemptLogin()">
                        <button class="password-submit" onclick="attemptLogin()"></button>
                    </div>
                    <p class="login-error" id="login-error" data-i18n="wrong_password">Wrong password</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading-overlay">
        <div class="windows-logo"><div></div><div></div><div></div><div></div></div>
        <p class="loading-text" id="loading-text">Loading...</p>
    </div>

    <!-- Desktop -->
    <div id="desktop">
        <div class="desktop-bg" id="desktop-bg"></div>
        <div id="desktop-area"></div>
        <div id="selection-box"></div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="taskbar-left">
                <div class="weather-widget"> 22C</div>
            </div>
            <div class="taskbar-center">
                <div class="taskbar-item" id="start-btn" onclick="toggleStartMenu()">
                    <svg viewBox="0 0 24 24"><path d="M3 3h8v8H3V3zm0 10h8v8H3v-8zm10-10h8v8h-8V3zm0 10h8v8h-8v-8z"/></svg>
                </div>
                <div class="taskbar-item" id="tb-explorer" onclick="openWindow('explorer')">
                    <svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"/></svg>
                </div>
                <div class="taskbar-item" id="tb-browser" onclick="openWindow('browser')">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg>
                </div>
                <div class="taskbar-item" id="tb-player" onclick="openWindow('player')">
                    <svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                </div>
            </div>
            <div class="taskbar-right">
                <div class="system-tray">
                    <svg viewBox="0 0 24 24"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9z"/></svg>
                    <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg>
                </div>
                <div class="clock">
                    <div class="clock-time" id="clock-time">12:00</div>
                    <div class="clock-date" id="clock-date">01.01</div>
                </div>
            </div>
        </div>

        <!-- Start Menu -->
        <div id="start-menu">
            <div class="start-search">
                <input type="text" data-i18n-placeholder="search" placeholder="Search..." id="start-search" oninput="filterApps(this.value)">
            </div>
            <div class="start-section">
                <h3 data-i18n="pinned">Pinned</h3>
                <div class="pinned-apps" id="pinned-apps"></div>
            </div>
            <div class="start-footer">
                <div class="start-user">
                    <div class="start-user-avatar" id="start-avatar">A</div>
                    <span id="start-name">Artuom</span>
                </div>
                <button class="power-btn" onclick="shutdownPC()">
                    <svg viewBox="0 0 24 24"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></svg>
                </button>
            </div>
        </div>

        <!-- Browser Window -->
        <div class="window" id="browser-window">
            <div class="window-header">
                <div class="window-title"> Microsoft Edge</div>
                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('browser')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('browser')"></div>
                    <div class="window-control close" onclick="closeWindow('browser')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="browser-tabs" id="browser-tabs"></div>
                <div class="browser-toolbar">
                    <button class="browser-nav-btn" id="browser-back" onclick="browserBack()" disabled></button>
                    <button class="browser-nav-btn" id="browser-forward" onclick="browserForward()" disabled></button>
                    <button class="browser-nav-btn" onclick="browserRefresh()"></button>
                    <button class="browser-nav-btn" onclick="browserHome()"></button>
                    <div class="browser-url-bar">
                        <span class="lock"></span>
                        <input type="text" class="browser-url" id="browser-url" onkeydown="if(event.key==='Enter')navigateUrl()">
                    </div>
                </div>
                <div class="browser-content" id="browser-view"></div>
            </div>
            <div class="window-resize"></div>
        </div>

        <!-- Explorer Window -->
        <div class="window" id="explorer-window">
            <div class="window-header">
                <div class="window-title" data-i18n="file_explorer"> File Explorer</div>
                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('explorer')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('explorer')"></div>
                    <div class="window-control close" onclick="closeWindow('explorer')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="explorer-toolbar">
                    <button onclick="explorerBack()" id="exp-back" disabled></button>
                    <button onclick="explorerForward()" id="exp-forward" disabled></button>
                    <button onclick="explorerUp()"></button>
                    <input type="text" class="explorer-path" id="explorer-path" readonly>
                </div>
                <div class="explorer-body">
                    <div class="explorer-sidebar" id="explorer-sidebar"></div>
                    <div class="explorer-content" id="explorer-content"></div>
                </div>
                <div class="explorer-statusbar" id="explorer-status">0 items</div>
            </div>
            <div class="window-resize"></div>
        </div>

        <!-- Notepad Window -->
        <div class="window" id="notepad-window">
            <div class="window-header">
                <div class="window-title" id="notepad-title"> Notepad</div>
                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('notepad')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('notepad')"></div>
                    <div class="window-control close" onclick="closeWindow('notepad')"></div>
                </div>
            </div>
            <div class="window-content">
                <textarea class="notepad-textarea" id="notepad-text" placeholder="Start typing..."></textarea>
                <div class="notepad-statusbar" id="notepad-status">Ln 1, Col 1</div>
            </div>
            <div class="window-resize"></div>
        </div>

        <!-- Settings Window -->
        <div class="window" id="settings-window">
            <div class="window-header">
                <div class="window-title" data-i18n="settings"> Settings</div>
                                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('settings')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('settings')"></div>
                    <div class="window-control close" onclick="closeWindow('settings')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="settings-layout">
                    <div class="settings-sidebar">
                        <div class="settings-nav-item active" onclick="showSettingsTab('account', this)"> <span data-i18n="accounts">Accounts</span></div>
                        <div class="settings-nav-item" onclick="showSettingsTab('personalization', this)"> <span data-i18n="personalization">Personalization</span></div>
                        <div class="settings-nav-item" onclick="showSettingsTab('language', this)"> <span data-i18n="language">Language</span></div>
                        <div class="settings-nav-item" onclick="showSettingsTab('about', this)"> <span data-i18n="about">About</span></div>
                    </div>
                    <div class="settings-main">
                        <!-- Account Tab -->
                        <div id="settings-account">
                            <h2 data-i18n="accounts">Accounts</h2>
                            <div class="setting-card">
                                <div class="setting-item">
                                    <div class="setting-item-info">
                                        <h4 data-i18n="username">Username</h4>
                                    </div>
                                    <input type="text" id="settings-username" style="width: 180px;">
                                    <button class="btn-small" style="margin-left: 8px;" onclick="saveUsername()" data-i18n="save">Save</button>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-item-info">
                                        <h4 data-i18n="change_password">Change Password</h4>
                                    </div>
                                    <button class="btn-small" onclick="changePassword()" data-i18n="change">Change</button>
                                </div>
                            </div>
                        </div>

                        <!-- Personalization Tab -->
                        <div id="settings-personalization" style="display: none;">
                            <h2 data-i18n="personalization">Personalization</h2>
                            <h3 style="font-size: 14px; margin-bottom: 12px; font-weight: 400;" data-i18n="wallpaper">Wallpaper</h3>
                            <div class="wallpaper-grid" id="wallpaper-grid"></div>
                            
                            <h3 style="font-size: 14px; margin: 20px 0 12px; font-weight: 400;" data-i18n="custom_wallpaper">Custom Wallpaper</h3>
                            <div class="custom-wallpaper-drop" id="wallpaper-drop">
                                <span></span>
                                <p data-i18n="drop_image">Drop image or video here</p>
                            </div>
                        </div>

                        <!-- Language Tab -->
                        <div id="settings-language" style="display: none;">
                            <h2 data-i18n="language">Language</h2>
                            <div class="setting-card">
                                <div class="setting-item">
                                    <div class="setting-item-info">
                                        <h4 data-i18n="display_language">Display Language</h4>
                                    </div>
                                    <select id="settings-lang" onchange="changeLanguage(this.value)" style="width: 150px;">
                                        <option value="ru"> </option>
                                        <option value="en"> English</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- About Tab -->
                        <div id="settings-about" style="display: none;">
                            <h2 data-i18n="about">About</h2>
                            <div class="setting-card">
                                <div class="setting-item">
                                    <div class="setting-item-info"><h4>Windows</h4></div>
                                    <span>Windows 12 Pro</span>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-item-info"><h4>Build</h4></div>
                                    <span>12.0.1000</span>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-item-info"><h4 data-i18n="device_name">Device Name</h4></div>
                                    <span>DESKTOP-WIN12</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="window-resize"></div>
        </div>

        <!-- Recycle Bin Window -->
        <div class="window" id="recycle-window">
            <div class="window-header">
                <div class="window-title" data-i18n="recycle_bin"> Recycle Bin</div>
                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('recycle')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('recycle')"></div>
                    <div class="window-control close" onclick="closeWindow('recycle')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="recycle-toolbar">
                    <button onclick="restoreSelected()" id="restore-btn" disabled data-i18n="restore"> Restore</button>
                    <button onclick="deleteForever()" id="delete-btn" disabled data-i18n="delete"> Delete</button>
                    <button onclick="emptyRecycleBin()" data-i18n="empty_bin"> Empty</button>
                </div>
                <div class="recycle-content" id="recycle-content"></div>
            </div>
            <div class="window-resize"></div>
        </div>

        <!-- Media Player Window -->
        <div class="window" id="player-window">
            <div class="window-header">
                <div class="window-title" data-i18n="media_player"> Media Player</div>
                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('player')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('player')"></div>
                    <div class="window-control close" onclick="closeWindow('player')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="player-content">
                    <div class="player-display" id="player-display">
                        <div class="player-dropzone" id="player-dropzone">
                            <div class="drop-icon"></div>
                            <h3 data-i18n="drop_media">Drop media file here</h3>
                            <p>MP3, MP4, WebM, OGG</p>
                        </div>
                    </div>
                    <div class="player-controls">
                        <div class="player-progress" onclick="seekPlayer(event)">
                            <div class="player-progress-bar" id="player-progress"></div>
                        </div>
                        <div class="player-buttons">
                            <button class="player-btn" onclick="playerPrev()"></button>
                            <button class="player-btn play" id="play-btn" onclick="togglePlay()"></button>
                            <button class="player-btn" onclick="playerNext()"></button>
                            <span class="player-time"><span id="player-current">0:00</span> / <span id="player-duration">0:00</span></span>
                            <div class="player-info">
                                <div class="title" id="player-title" data-i18n="no_file">No file</div>
                            </div>
                            <div class="player-volume">
                                <span></span>
                                <input type="range" min="0" max="100" value="100" id="volume-slider" oninput="setVolume(this.value)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="window-resize"></div>
        </div>

        <!-- Calculator Window -->
        <div class="window" id="calculator-window">
            <div class="window-header">
                <div class="window-title" data-i18n="calculator"> Calculator</div>
                <div class="window-controls">
                    <div class="window-control minimize" onclick="minimizeWindow('calculator')"></div>
                    <div class="window-control maximize" onclick="maximizeWindow('calculator')"></div>
                    <div class="window-control close" onclick="closeWindow('calculator')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="calc-display">
                    <div class="calc-expression" id="calc-expr"></div>
                    <div class="calc-result" id="calc-result">0</div>
                </div>
                <div class="calc-buttons">
                    <button class="calc-btn op" onclick="calcClear()">C</button>
                    <button class="calc-btn op" onclick="calcClearEntry()">CE</button>
                    <button class="calc-btn op" onclick="calcBackspace()"></button>
                    <button class="calc-btn op" onclick="calcOp('/')"></button>
                    <button class="calc-btn" onclick="calcNum('7')">7</button>
                    <button class="calc-btn" onclick="calcNum('8')">8</button>
                    <button class="calc-btn" onclick="calcNum('9')">9</button>
                    <button class="calc-btn op" onclick="calcOp('*')"></button>
                    <button class="calc-btn" onclick="calcNum('4')">4</button>
                    <button class="calc-btn" onclick="calcNum('5')">5</button>
                    <button class="calc-btn" onclick="calcNum('6')">6</button>
                    <button class="calc-btn op" onclick="calcOp('-')"></button>
                    <button class="calc-btn" onclick="calcNum('1')">1</button>
                    <button class="calc-btn" onclick="calcNum('2')">2</button>
                    <button class="calc-btn" onclick="calcNum('3')">3</button>
                    <button class="calc-btn op" onclick="calcOp('+')">+</button>
                    <button class="calc-btn" onclick="calcNegate()"></button>
                    <button class="calc-btn" onclick="calcNum('0')">0</button>
                    <button class="calc-btn" onclick="calcNum('.')">.</button>
                    <button class="calc-btn eq" onclick="calcEquals()">=</button>
                </div>
            </div>
        </div>

        <!-- Context Menus -->
        <div id="context-menu">
            <div class="ctx-item" onclick="ctxRefresh()"><span class="icon"></span><span data-i18n="refresh">Refresh</span><span class="key">F5</span></div>
            <div class="ctx-divider"></div>
            <div class="ctx-item" onclick="ctxNewFolder()"><span class="icon"></span><span data-i18n="new_folder">New Folder</span></div>
            <div class="ctx-item" onclick="ctxNewFile()"><span class="icon"></span><span data-i18n="new_document">New Document</span></div>
            <div class="ctx-divider"></div>
            <div class="ctx-item" id="ctx-paste" onclick="ctxPaste()"><span class="icon"></span><span data-i18n="paste">Paste</span><span class="key">Ctrl+V</span></div>
            <div class="ctx-divider"></div>
            <div class="ctx-item" onclick="openApp('settings')"><span class="icon"></span><span data-i18n="settings">Settings</span></div>
        </div>

        <div id="icon-context-menu">
            <div class="ctx-item" onclick="ctxOpenIcon()"><span class="icon"></span><span data-i18n="open">Open</span></div>
            <div class="ctx-divider"></div>
            <div class="ctx-item" onclick="ctxCutIcon()"><span class="icon"></span><span data-i18n="cut">Cut</span><span class="key">Ctrl+X</span></div>
            <div class="ctx-item" onclick="ctxCopyIcon()"><span class="icon"></span><span data-i18n="copy">Copy</span><span class="key">Ctrl+C</span></div>
            <div class="ctx-divider"></div>
            <div class="ctx-item" onclick="ctxRenameIcon()"><span class="icon"></span><span data-i18n="rename">Rename</span><span class="key">F2</span></div>
            <div class="ctx-item" onclick="ctxDeleteIcon()"><span class="icon"></span><span data-i18n="delete">Delete</span><span class="key">Del</span></div>
        </div>
    </div>

    <!-- Input Dialog -->
    <div id="dialog-overlay"></div>
    <div id="input-dialog">
        <h3 id="dialog-title">Enter name</h3>
        <input type="text" id="dialog-input">
        <div class="dialog-buttons">
            <button class="btn-cancel" onclick="closeDialog()" data-i18n="cancel">Cancel</button>
            <button class="btn-ok" onclick="confirmDialog()">OK</button>
        </div>
    </div>

    <script>
        // ==================== TRANSLATIONS ====================
        const i18n = {
            ru: {
                // Setup
                setup_lang_title: '',
                setup_lang_desc: '  ',
                setup_account_title: ' ',
                setup_account_desc: ' ',
                setup_theme_title: '',
                setup_theme_desc: ' ',
                setup_ready_title: '!',
                setup_ready_desc: ' ',
                username: ' ',
                password: '',
                confirm_password: ' ',
                next: ' ',
                back: ' ',
                finish: ' ',
                
                // Login
                click_to_login: '  ',
                wrong_password: ' ',
                
                // Desktop & Apps
                search: '...',
                pinned: '',
                file_explorer: ' ',
                settings: ' ',
                recycle_bin: ' ',
                media_player: ' ',
                calculator: ' ',
                notepad: ' ',
                
                // Settings
                accounts: ' ',
                personalization: '',
                language: '',
                about: ' ',
                change_password: ' ',
                change: '',
                save: '',
                wallpaper: '',
                custom_wallpaper: ' ',
                drop_image: '   ',
                display_language: ' ',
                device_name: ' ',
                
                // Context menu
                refresh: '',
                new_folder: ' ',
                new_document: ' ',
                paste: '',
                open: '',
                cut: '',
                copy: '',
                rename: '',
                delete: '',
                
                // Recycle bin
                restore: ' ',
                empty_bin: ' ',
                
                // Media player
                drop_media: '  ',
                no_file: ' ',
                
                // Other
                cancel: '',
                this_pc: ' ',
                desktop: ' ',
                downloads: '',
                documents: '',
                pictures: '',
                music: '',
                videos: '',
                items: '',
                access_denied: ' ',
                system_folder: '  ',
                
                // Themes
                theme_light: '',
                theme_dark: '',
                theme_nature: '',
                theme_sunset: '',
                theme_ocean: '',
                theme_gradient: '',
                theme_aurora: '',
                theme_waves: '',
                theme_particles: '',
                
                // Days & months
                monday: '',
                tuesday: '',
                wednesday: '',
                thursday: '',
                friday: '',
                saturday: '',
                sunday: '',
                january: '', february: '', march: '',
                april: '', may: '', june: '',
                july: '', august: '', september: '',
                october: '', november: '', december: ''
            },
            en: {
                setup_lang_title: 'Language',
                setup_lang_desc: 'Choose your language',
                setup_account_title: 'Account',
                setup_account_desc: 'Create your user',
                setup_theme_title: 'Theme',
                setup_theme_desc: 'Choose your wallpaper',
                setup_ready_title: 'Ready!',
                setup_ready_desc: 'Review your settings',
                username: 'Username',
                password: 'Password',
                confirm_password: 'Confirm Password',
                next: 'Next ',
                back: ' Back',
                finish: 'Finish ',
                click_to_login: 'Click to sign in',
                wrong_password: 'Wrong password',
                search: 'Search...',
                pinned: 'Pinned',
                file_explorer: ' File Explorer',
                settings: ' Settings',
                recycle_bin: ' Recycle Bin',
                media_player: ' Media Player',
                calculator: ' Calculator',
                notepad: ' Notepad',
                accounts: 'Accounts',
                personalization: 'Personalization',
                language: 'Language',
                about: 'About',
                change_password: 'Change Password',
                change: 'Change',
                save: 'Save',
                wallpaper: 'Wallpaper',
                custom_wallpaper: 'Custom Wallpaper',
                drop_image: 'Drop image or video here',
                display_language: 'Display Language',
                device_name: 'Device Name',
                refresh: 'Refresh',
                new_folder: 'New Folder',
                new_document: 'New Document',
                paste: 'Paste',
                open: 'Open',
                cut: 'Cut',
                copy: 'Copy',
                rename: 'Rename',
                delete: 'Delete',
                restore: ' Restore',
                empty_bin: ' Empty',
                drop_media: 'Drop media file here',
                no_file: 'No file',
                cancel: 'Cancel',
                this_pc: 'This PC',
                desktop: 'Desktop',
                downloads: 'Downloads',
                documents: 'Documents',
                pictures: 'Pictures',
                music: 'Music',
                videos: 'Videos',
                items: 'items',
                access_denied: 'Access Denied',
                system_folder: 'System folder is protected',
                theme_light: 'Light',
                theme_dark: 'Dark',
                theme_nature: 'Nature',
                theme_sunset: 'Sunset',
                theme_ocean: 'Ocean',
                theme_gradient: 'Gradient',
                theme_aurora: 'Aurora',
                theme_waves: 'Waves',
                theme_particles: 'Particles',
                monday: 'Monday', tuesday: 'Tuesday', wednesday: 'Wednesday',
                thursday: 'Thursday', friday: 'Friday', saturday: 'Saturday', sunday: 'Sunday',
                january: 'January', february: 'February', march: 'March',
                april: 'April', may: 'May', june: 'June',
                july: 'July', august: 'August', september: 'September',
                october: 'October', november: 'November', december: 'December'
            }
        };

        // ==================== THEMES/WALLPAPERS ====================
        const wallpapers = {
            light: { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', animated: false },
            dark: { bg: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)', animated: false },
            nature: { bg: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)', animated: false },
            sunset: { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', animated: false },
            ocean: { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', animated: false },
            gradient: { bg: 'bg-animated-gradient', animated: true, class: true },
            aurora: { bg: 'bg-animated-aurora', animated: true, class: true },
            waves: { bg: 'bg-animated-waves', animated: true, class: true },
            particles: { bg: 'bg-animated-particles', animated: true, class: true, init: initParticles }
        };

        // ==================== SYSTEM STATE ====================
        let state = {
            username: 'Artuom',
            password: '1286',
            theme: 'light',
            language: 'ru',
            customWallpaper: null,
            customWallpaperType: null, // 'image' or 'video'
            setupDone: false
        };

        // ==================== FILE SYSTEM ====================
        let fileSystem = {
            'desktop': [],
            'downloads': [{ name: 'File.pdf', icon: '', type: 'file' }],
            'documents': [{ name: 'Notes.txt', icon: '', type: 'file' }],
            'pictures': [{ name: 'Photo.jpg', icon: '', type: 'file' }],
            'music': [{ name: 'Song.mp3', icon: '', type: 'file' }],
            'videos': [{ name: 'Video.mp4', icon: '', type: 'file' }],
            'C:': [
                { name: 'Program Files', icon: '', type: 'folder', locked: true },
                { name: 'Windows', icon: '', type: 'folder', locked: true },
                { name: 'Users', icon: '', type: 'folder', locked: true }
            ]
        };

        let recycleBin = [];
        let desktopIcons = [];
        let clipboard = null;
        let clipboardAction = null;
        let contextClickPos = { x: 0, y: 0 };

        // ==================== INITIALIZATION ====================
        function init() {
            loadState();
            initThemeGrid();
            initWallpaperGrid();
            initStartMenu();
            initExplorerSidebar();
            initPlayer();
            initWallpaperDrop();
            startBoot();
        }

        function loadState() {
            const saved = localStorage.getItem('win12');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
        }

        function saveState() {
            localStorage.setItem('win12', JSON.stringify(state));
        }

        // ==================== LANGUAGE ====================
        function changeLanguage(lang) {
            state.language = lang;
            saveState();
            applyLanguage();
            document.getElementById('setup-language').value = lang;
            document.getElementById('settings-lang').value = lang;
        }

        function applyLanguage() {
            const lang = state.language;
            const t = i18n[lang];

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) el.placeholder = t[key];
            });

            // Update dynamic content
            updateClock();
            if (document.getElementById('desktop').style.display !== 'none') {
                renderExplorer();
            }
        }

        function t(key) {
            return i18n[state.language][key] || key;
        }

        // ==================== THEMES ====================
        function initThemeGrid() {
            const grid = document.getElementById('theme-grid');
            grid.innerHTML = '';

            const themeList = [
                { id: 'light', name: 'theme_light' },
                { id: 'dark', name: 'theme_dark' },
                { id: 'nature', name: 'theme_nature' },
                { id: 'sunset', name: 'theme_sunset' },
                { id: 'ocean', name: 'theme_ocean' },
                { id: 'gradient', name: 'theme_gradient', animated: true },
                { id: 'aurora', name: 'theme_aurora', animated: true },
                { id: 'waves', name: 'theme_waves', animated: true },
                { id: 'particles', name: 'theme_particles', animated: true }
            ];

            themeList.forEach(theme => {
                const div = document.createElement('div');
                div.className = 'theme-card' + (state.theme === theme.id ? ' selected' : '');
                div.dataset.theme = theme.id;
                
                const wp = wallpapers[theme.id];
                if (wp.class) {
                    div.classList.add(wp.bg);
                } else {
                    div.style.background = wp.bg;
                }

                div.innerHTML = `
                    <span data-i18n="${theme.name}">${t(theme.name)}</span>
                    ${theme.animated ? '<div class="animated-badge"></div>' : ''}
                `;
                div.onclick = () => selectThemeInSetup(theme.id, div);
                grid.appendChild(div);
            });
        }

        function selectThemeInSetup(themeId, el) {
            state.theme = themeId;
            document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            applyThemeToElement(document.getElementById('setup-bg'), themeId);
        }

        function initWallpaperGrid() {
            const grid = document.getElementById('wallpaper-grid');
            if (!grid) return;
            grid.innerHTML = '';

            const themeList = [
                { id: 'light', name: 'theme_light' },
                { id: 'dark', name: 'theme_dark' },
                { id: 'nature', name: 'theme_nature' },
                { id: 'sunset', name: 'theme_sunset' },
                { id: 'ocean', name: 'theme_ocean' },
                { id: 'gradient', name: 'theme_gradient', animated: true },
                { id: 'aurora', name: 'theme_aurora', animated: true },
                { id: 'waves', name: 'theme_waves', animated: true }
            ];

            themeList.forEach(theme => {
                const div = document.createElement('div');
                div.className = 'wallpaper-item' + (state.theme === theme.id && !state.customWallpaper ? ' selected' : '');
                
                const wp = wallpapers[theme.id];
                if (wp.class) {
                    div.classList.add(wp.bg);
                } else {
                    div.style.background = wp.bg;
                }

                div.innerHTML = `
                    <span data-i18n="${theme.name}">${t(theme.name)}</span>
                    ${theme.animated ? '<div class="badge"></div>' : ''}
                `;
                div.onclick = () => {
                    state.theme = theme.id;
                    state.customWallpaper = null;
                    state.customWallpaperType = null;
                    saveState();
                    applyTheme();
                    initWallpaperGrid();
                };
                grid.appendChild(div);
            });
        }

        function applyTheme() {
            applyThemeToElement(document.getElementById('desktop-bg'), state.theme);
            applyThemeToElement(document.getElementById('login-bg'), state.theme);
            initWallpaperGrid();
        }

        function applyThemeToElement(el, themeId) {
            if (!el) return;

            // Clear previous
            el.className = el.id === 'desktop-bg' || el.id === 'login-bg' || el.id === 'setup-bg' ? el.id.replace('-', '-') : '';
            el.classList.add(el.id);
            el.style.background = '';
            el.innerHTML = '';

            // Custom wallpaper
            if (state.customWallpaper && (el.id === 'desktop-bg' || el.id === 'login-bg')) {
                if (state.customWallpaperType === 'video') {
                    const video = document.createElement('video');
                    video.className = 'bg-video';
                    video.src = state.customWallpaper;
                    video.autoplay = true;
                    video.loop = true;
                    video.muted = true;
                    el.appendChild(video);
                } else {
                    el.style.backgroundImage = `url(${state.customWallpaper})`;
                    el.classList.add('bg-custom-image');
                }
                return;
            }

            const wp = wallpapers[themeId];
            if (!wp) return;

            if (wp.class) {
                el.classList.add(wp.bg);
                if (wp.init) wp.init(el);
            } else {
                el.style.background = wp.bg;
            }
        }

        function initParticles(container) {
            for (let i = 0; i < 50; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.animationDelay = Math.random() * 15 + 's';
                p.style.animationDuration = (10 + Math.random() * 10) + 's';
                container.appendChild(p);
            }
        }

        // ==================== CUSTOM WALLPAPER DROP ====================
        function initWallpaperDrop() {
            const drop = document.getElementById('wallpaper-drop');
            if (!drop) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
                drop.addEventListener(e, ev => ev.preventDefault());
            });

            drop.addEventListener('dragenter', () => drop.classList.add('dragover'));
            drop.addEventListener('dragleave', () => drop.classList.remove('dragover'));
            drop.addEventListener('drop', e => {
                drop.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (!file) return;

                const isVideo = file.type.startsWith('video/');
                const isImage = file.type.startsWith('image/');

                if (!isVideo && !isImage) {
                    showNotification(t('error') || 'Error', 'Only images and videos');
                    return;
                }

                const reader = new FileReader();
                reader.onload = ev => {
                    state.customWallpaper = ev.target.result;
                    state.customWallpaperType = isVideo ? 'video' : 'image';
                    saveState();
                    applyTheme();
                    showNotification(t('personalization'), t('wallpaper') + ' updated');
                };
                reader.readAsDataURL(file);
            });
        }

        // ==================== START MENU ====================
        function initStartMenu() {
            const apps = [
                { id: 'browser', icon: '', name: 'Edge', color: 'linear-gradient(135deg, #0078d4, #00bcf2)' },
                { id: 'explorer', icon: '', name: t('file_explorer').replace(' ', ''), color: 'linear-gradient(135deg, #ffc107, #ff9800)' },
                { id: 'settings', icon: '', name: t('settings').replace(' ', ''), color: 'linear-gradient(135deg, #555, #333)' },
                { id: 'notepad', icon: '', name: 'Notepad', color: 'linear-gradient(135deg, #7c4dff, #448aff)' },
                { id: 'calculator', icon: '', name: t('calculator').replace(' ', ''), color: 'linear-gradient(135deg, #607d8b, #455a64)' },
                { id: 'player', icon: '', name: 'Player', color: 'linear-gradient(135deg, #e91e63, #9c27b0)' }
            ];

            const container = document.getElementById('pinned-apps');
            container.innerHTML = '';
            apps.forEach(app => {
                const div = document.createElement('div');
                div.className = 'app-tile';
                div.onclick = () => openApp(app.id);
                div.innerHTML = `
                    <div class="app-icon" style="background: ${app.color}">${app.icon}</div>
                    <span>${app.name}</span>
                `;
                container.appendChild(div);
            });
        }

        function toggleStartMenu() {
            document.getElementById('start-menu').classList.toggle('show');
        }

        function closeStartMenu() {
            document.getElementById('start-menu').classList.remove('show');
        }

        function filterApps(q) {
            q = q.toLowerCase();
            document.querySelectorAll('.app-tile').forEach(tile => {
                const name = tile.querySelector('span').textContent.toLowerCase();
                tile.style.display = name.includes(q) ? '' : 'none';
            });
        }

        // ==================== EXPLORER SIDEBAR ====================
        function initExplorerSidebar() {
            const sidebar = document.getElementById('explorer-sidebar');
            if (!sidebar) return;

            const items = [
                { path: 'desktop', icon: '', key: 'desktop' },
                { path: 'downloads', icon: '', key: 'downloads' },
                { path: 'documents', icon: '', key: 'documents' },
                { path: 'pictures', icon: '', key: 'pictures' },
                { path: 'music', icon: '', key: 'music' },
                { path: 'videos', icon: '', key: 'videos' },
                { path: 'C:', icon: '', key: 'this_pc', label: 'C:' }
            ];

            sidebar.innerHTML = '<div class="explorer-sidebar-title" data-i18n="this_pc">' + t('this_pc') + '</div>';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'explorer-sidebar-item';
                div.innerHTML = `${item.icon} <span data-i18n="${item.key}">${t(item.key)}</span>${item.label ? ' ' + item.label : ''}`;
                div.onclick = () => navigateExplorer(item.path);
                sidebar.appendChild(div);
            });
        }

        // ==================== BOOT SEQUENCE ====================
        let deleteCount = 0;
        let bootTimer = null;
        let recoveryMode = false;

        function startBoot() {
            bootTimer = setTimeout(() => {
                document.getElementById('boot-screen').style.display = 'none';
                if (state.setupDone) {
                    showLogin();
                } else {
                    showSetup();
                }
            }, 3000);
        }

        document.addEventListener('keydown', e => {
            const boot = document.getElementById('boot-screen');
            if (boot.style.display !== 'none' && getComputedStyle(boot).display !== 'none') {
                if (e.key === 'Delete') {
                    deleteCount++;
                    if (deleteCount >= 5) {
                        clearTimeout(bootTimer);
                        showBios();
                    }
                }
            }
            if (e.key === 'Escape' && document.getElementById('bios-screen').style.display === 'block') {
                exitBios();
            }
        });

        // ==================== BIOS ====================
        function showBios() {
            document.getElementById('boot-screen').style.display = 'none';
            document.getElementById('bios-screen').style.display = 'block';
            showBiosSection('info');
            updateBiosTime();
            setInterval(updateBiosTime, 1000);
        }

        function showBiosSection(section) {
            document.querySelectorAll('.bios-menu-item').forEach(i => i.classList.remove('selected'));
            document.querySelector(`.bios-menu-item[data-section="${section}"]`).classList.add('selected');

            const main = document.getElementById('bios-main');
            if (section === 'info') {
                main.innerHTML = `
                    <h3 style="color: #ff0; margin-bottom: 12px;">System Information</h3>
                    <p>BIOS: v12.0.0</p>
                    <p>CPU: Intel Core i7</p>
                    <p>RAM: 32 GB</p>
                    <p>Date: <span id="bios-date"></span></p>
                    <p>Time: <span id="bios-time"></span></p>
                `;
                updateBiosTime();
            } else if (section === 'recovery') {
                main.innerHTML = `
                    <h3 style="color: #f66; margin-bottom: 12px;"> Recovery Reset</h3>
                    <p>This will reset ALL settings!</p>
                    <button onclick="document.getElementById('bios-confirm').style.display='block'" style="margin-top: 15px; padding: 8px 16px; background: #a00; color: #fff; border: 2px solid #fff; cursor: pointer;">Reset</button>
                `;
            } else if (section === 'exit') {
                main.innerHTML = `
                    <h3 style="color: #ff0; margin-bottom: 12px;">Save & Exit</h3>
                    <button onclick="exitBios()" style="display: block; width: 100%; padding: 10px; margin-bottom: 8px; background: #080; color: #fff; border: 2px solid #fff; cursor: pointer;">Exit</button>
                `;
            }
        }

        document.querySelectorAll('.bios-menu-item').forEach(item => {
            item.onclick = () => showBiosSection(item.dataset.section);
        });

        function updateBiosTime() {
            const now = new Date();
            const dateEl = document.getElementById('bios-date');
            const timeEl = document.getElementById('bios-time');
            if (dateEl) dateEl.textContent = now.toLocaleDateString();
            if (timeEl) timeEl.textContent = now.toLocaleTimeString();
        }

        function doRecovery() {
            recoveryMode = true;
            document.getElementById('bios-confirm').style.display = 'none';
            exitBios();
        }

        function cancelRecovery() {
            document.getElementById('bios-confirm').style.display = 'none';
        }

        function exitBios() {
            document.getElementById('bios-screen').style.display = 'none';
            if (recoveryMode) {
                localStorage.clear();
                state = { username: 'Artuom', password: '1286', theme: 'light', language: 'ru', setupDone: false };
                recoveryMode = false;
            }
            document.getElementById('boot-screen').style.display = 'flex';
            deleteCount = 0;
            startBoot();
        }

        // ==================== SETUP ====================
        let setupStep = 1;

        function showSetup() {
            applyThemeToElement(document.getElementById('setup-bg'), state.theme);
            document.getElementById('setup-screen').style.display = 'block';
            applyLanguage();
            initThemeGrid();
        }

        function nextSetupStep() {
            if (setupStep === 2) {
                const user = document.getElementById('setup-username').value;
                const pass = document.getElementById('setup-password').value;
                const pass2 = document.getElementById('setup-password2').value;
                if (!user || !pass) {
                    showNotification('Error', 'Fill all fields');
                    return;
                }
                if (pass !== pass2) {
                    showNotification('Error', 'Passwords do not match');
                    return;
                }
                state.username = user;
                state.password = pass;
            }

            if (setupStep === 3) {
                // Update summary
                document.getElementById('summary-user').textContent = ' ' + t('username') + ': ' + state.username;
                document.getElementById('summary-lang').textContent = ' ' + t('language') + ': ' + (state.language === 'ru' ? '' : 'English');
                document.getElementById('summary-theme').textContent = ' Theme: ' + t('theme_' + state.theme);
            }

            document.querySelector(`.setup-step[data-step="${setupStep}"]`).classList.remove('active');
            setupStep++;
            document.querySelector(`.setup-step[data-step="${setupStep}"]`).classList.add('active');
        }

        function prevSetupStep() {
            document.querySelector(`.setup-step[data-step="${setupStep}"]`).classList.remove('active');
            setupStep--;
            document.querySelector(`.setup-step[data-step="${setupStep}"]`).classList.add('active');
        }

        function finishSetup() {
            state.setupDone = true;
            saveState();

            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('loading-overlay').style.display = 'flex';

            const msgs = state.language === 'ru' 
                ? [' ...', ' ...', '...']
                : ['Applying settings...', 'Creating profile...', 'Preparing...'];

            let i = 0;
            const interval = setInterval(() => {
                document.getElementById('loading-text').textContent = msgs[i++];
                if (i >= msgs.length) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loading-overlay').style.display = 'none';
                        showLogin();
                    }, 800);
                }
            }, 800);
        }

        // ==================== LOGIN ====================
        function showLogin() {
            applyTheme();
            applyLanguage();
            document.getElementById('login-name').textContent = state.username;
            document.getElementById('login-avatar').textContent = state.username.charAt(0).toUpperCase();
            document.getElementById('login-screen').style.display = 'block';
            updateLoginTime();
            setInterval(updateLoginTime, 1000);
        }

        function updateLoginTime() {
            const now = new Date();
            document.getElementById('login-time').textContent = now.toLocaleTimeString(state.language === 'ru' ? 'ru-RU' : 'en-US', { hour: '2-digit', minute: '2-digit' });

            const months = state.language === 'ru' 
                ? ['', '', '', '', '', '', '', '', '', '', '', '']
                : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('login-date').textContent = now.getDate() + ' ' + months[now.getMonth()];
        }

        function showPasswordBox() {
            document.getElementById('click-hint').style.display = 'none';
            document.getElementById('password-box').classList.add('show');
            document.getElementById('login-password').focus();
        }

        function attemptLogin() {
            const pass = document.getElementById('login-password').value;
            if (pass === state.password) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('loading-overlay').style.display = 'flex';
                document.getElementById('loading-text').textContent = state.language === 'ru' ? ' !' : 'Welcome!';

                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                    showDesktop();
                }, 1200);
            } else {
                document.getElementById('login-error').style.display = 'block';
                document.getElementById('login-password').value = '';
                document.querySelector('.password-field').style.animation = 'shake 0.4s';
                setTimeout(() => document.querySelector('.password-field').style.animation = '', 400);
            }
        }

        // ==================== DESKTOP ====================
        function showDesktop() {
            applyTheme();
            applyLanguage();
            updateUserUI();
            initDesktopIcons();
            initStartMenu();
            initExplorerSidebar();
            document.getElementById('desktop').style.display = 'block';
            updateClock();
            setInterval(updateClock, 1000);
        }

        function updateUserUI() {
            document.getElementById('start-name').textContent = state.username;
            document.getElementById('start-avatar').textContent = state.username.charAt(0).toUpperCase();
            document.getElementById('settings-username').value = state.username;
            document.getElementById('settings-lang').value = state.language;
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock-time').textContent = now.toLocaleTimeString(state.language === 'ru' ? 'ru-RU' : 'en-US', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock-date').textContent = now.toLocaleDateString(state.language === 'ru' ? 'ru-RU' : 'en-US', { day: '2-digit', month: '2-digit' });
        }

        // ==================== DESKTOP ICONS ====================
        function initDesktopIcons() {
            const saved = localStorage.getItem('desktopIcons');
            if (saved) {
                desktopIcons = JSON.parse(saved);
            } else {
                desktopIcons = [
                    { id: 'icon-pc', name: t('this_pc'), icon: '', action: 'explorer', x: 20, y: 20 },
                    { id: 'icon-recycle', name: t('recycle_bin').replace(' ', ''), icon: '', action: 'recycle', x: 20, y: 100 },
                    { id: 'icon-edge', name: 'Edge', icon: '', action: 'browser', x: 20, y: 180 },
                    { id: 'icon-notepad', name: 'Notepad', icon: '', action: 'notepad', x: 20, y: 260 }
                ];
            }
            renderDesktopIcons();
        }

        function renderDesktopIcons() {
            const area = document.getElementById('desktop-area');
            area.innerHTML = '';

            desktopIcons.forEach((icon, idx) => {
                const el = document.createElement('div');
                el.className = 'desktop-icon';
                el.dataset.index = idx;
                el.style.left = icon.x + 'px';
                el.style.top = icon.y + 'px';
                el.innerHTML = `<div class="icon-img">${icon.icon}</div><span>${icon.name}</span>`;
                el.ondblclick = () => openIconAction(icon);
                el.onmousedown = e => startIconDrag(e, idx);
                el.oncontextmenu = e => showIconContextMenu(e, idx);
                area.appendChild(el);
            });

            localStorage.setItem('desktopIcons', JSON.stringify(desktopIcons));
        }

        function openIconAction(icon) {
            if (icon.action) {
                openWindow(icon.action);
            } else if (icon.type === 'folder') {
                openWindow('explorer');
                setTimeout(() => navigateExplorer(icon.path || 'desktop'), 100);
            } else if (icon.type === 'file' && icon.name.endsWith('.txt')) {
                openWindow('notepad');
                document.getElementById('notepad-text').value = icon.content || '';
                document.getElementById('notepad-title').textContent = ' ' + icon.name;
            }
        }

        // ==================== ICON DRAG & DROP ====================
        let draggedIdx = [];
        let isDragging = false;
        let dragOffsets = [];

        function startIconDrag(e, idx) {
            if (e.button !== 0) return;
            e.preventDefault();

            const el = document.querySelector(`[data-index="${idx}"]`);
            if (!el.classList.contains('selected')) {
                if (!e.ctrlKey) clearIconSelection();
                el.classList.add('selected');
            }

            const selected = document.querySelectorAll('.desktop-icon.selected');
            draggedIdx = [];
            dragOffsets = [];

            selected.forEach(sel => {
                const i = parseInt(sel.dataset.index);
                draggedIdx.push(i);
                dragOffsets.push({ x: e.clientX - desktopIcons[i].x, y: e.clientY - desktopIcons[i].y });
                sel.classList.add('dragging');
            });

            isDragging = true;
            document.addEventListener('mousemove', onIconDrag);
            document.addEventListener('mouseup', endIconDrag);
        }

        function onIconDrag(e) {
            if (!isDragging) return;
            draggedIdx.forEach((idx, i) => {
                desktopIcons[idx].x = Math.max(0, Math.min(e.clientX - dragOffsets[i].x, window.innerWidth - 90));
                desktopIcons[idx].y = Math.max(0, Math.min(e.clientY - dragOffsets[i].y, window.innerHeight - 140));
                const el = document.querySelector(`[data-index="${idx}"]`);
                if (el) {
                    el.style.left = desktopIcons[idx].x + 'px';
                    el.style.top = desktopIcons[idx].y + 'px';
                }
            });
        }

        function endIconDrag() {
            draggedIdx.forEach(idx => {
                const el = document.querySelector(`[data-index="${idx}"]`);
                if (el) el.classList.remove('dragging');
            });
            isDragging = false;
            localStorage.setItem('desktopIcons', JSON.stringify(desktopIcons));
            document.removeEventListener('mousemove', onIconDrag);
            document.removeEventListener('mouseup', endIconDrag);
        }

        // ==================== SELECTION BOX ====================
        let isSelecting = false;
        let selStart = { x: 0, y: 0 };

        document.getElementById('desktop-area')?.addEventListener('mousedown', function(e) {
            if (e.target.closest('.desktop-icon') || e.button !== 0) return;
            clearIconSelection();
            isSelecting = true;
            selStart = { x: e.clientX, y: e.clientY };
            const box = document.getElementById('selection-box');
            box.style.left = e.clientX + 'px';
            box.style.top = e.clientY + 'px';
            box.style.width = '0';
            box.style.height = '0';
            box.style.display = 'block';
        });

        document.addEventListener('mousemove', function(e) {
            if (!isSelecting) return;
            const box = document.getElementById('selection-box');
            const x = Math.min(e.clientX, selStart.x);
            const y = Math.min(e.clientY, selStart.y);
            const w = Math.abs(e.clientX - selStart.x);
            const h = Math.abs(e.clientY - selStart.y);
            box.style.left = x + 'px';
            box.style.top = y + 'px';
            box.style.width = w + 'px';
            box.style.height = h + 'px';

            const boxRect = { left: x, top: y, right: x + w, bottom: y + h };
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                const rect = icon.getBoundingClientRect();
                icon.classList.toggle('selected', rectsIntersect(boxRect, { left: rect.left, top: rect.top, right: rect.right, bottom: rect.bottom }));
            });
        });

        document.addEventListener('mouseup', function() {
            if (isSelecting) {
                isSelecting = false;
                document.getElementById('selection-box').style.display = 'none';
            }
        });

        function rectsIntersect(a, b) {
            return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
        }

        function clearIconSelection() {
            document.querySelectorAll('.desktop-icon.selected').forEach(el => el.classList.remove('selected'));
        }

        // ==================== CONTEXT MENUS ====================
        let contextIconIdx = -1;

        document.getElementById('desktop-area')?.addEventListener('contextmenu', function(e) {
            if (e.target.closest('.desktop-icon')) return;
            e.preventDefault();
            contextClickPos = { x: e.clientX, y: e.clientY };
            hideAllMenus();
            const menu = document.getElementById('context-menu');
            menu.style.display = 'block';
            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
            document.getElementById('ctx-paste').classList.toggle('disabled', !clipboard);
        });

        function showIconContextMenu(e, idx) {
            e.preventDefault();
            e.stopPropagation();
            contextIconIdx = idx;
            hideAllMenus();
            const menu = document.getElementById('icon-context-menu');
            menu.style.display = 'block';
            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
        }

        document.addEventListener('click', e => {
            if (!e.target.closest('#context-menu') && !e.target.closest('#icon-context-menu')) {
                hideAllMenus();
            }
            if (!e.target.closest('#start-menu') && !e.target.closest('#start-btn')) {
                closeStartMenu();
            }
        });

        function hideAllMenus() {
            document.getElementById('context-menu').style.display = 'none';
            document.getElementById('icon-context-menu').style.display = 'none';
        }

        function ctxRefresh() {
            hideAllMenus();
            renderDesktopIcons();
            showNotification(t('refresh'), 'OK');
        }

        function ctxNewFolder() {
            hideAllMenus();
            showInputDialog(t('new_folder'), t('new_folder'), name => {
                if (name) {
                    const id = 'folder-' + Date.now();
                    desktopIcons.push({
                        id, name, icon: '', type: 'folder',
                        x: contextClickPos.x, y: contextClickPos.y,
                        path: 'desktop/' + id
                    });
                    fileSystem['desktop/' + id] = [];
                    renderDesktopIcons();
                }
            });
        }

        function ctxNewFile() {
            hideAllMenus();
            showInputDialog(t('new_document'), 'Document.txt', name => {
                if (name) {
                    desktopIcons.push({
                        id: 'file-' + Date.now(), name, icon: '', type: 'file',
                        x: contextClickPos.x, y: contextClickPos.y, content: ''
                    });
                    renderDesktopIcons();
                }
            });
        }

        function ctxPaste() {
            hideAllMenus();
            if (!clipboard) return;
            clipboard.forEach(item => {
                desktopIcons.push({
                    ...item,
                    id: item.id + '-copy-' + Date.now(),
                    x: contextClickPos.x + Math.random() * 20,
                    y: contextClickPos.y + Math.random() * 20
                });
            });
            if (clipboardAction === 'cut') clipboard = null;
            renderDesktopIcons();
        }

        function ctxOpenIcon() {
            hideAllMenus();
            if (contextIconIdx >= 0) openIconAction(desktopIcons[contextIconIdx]);
        }

        function ctxCutIcon() {
            hideAllMenus();
            const sel = getSelectedIndices();
            clipboard = sel.map(i => ({ ...desktopIcons[i] }));
            clipboardAction = 'cut';
        }

        function ctxCopyIcon() {
            hideAllMenus();
            const sel = getSelectedIndices();
            clipboard = sel.map(i => ({ ...desktopIcons[i] }));
            clipboardAction = 'copy';
        }

        function ctxRenameIcon() {
            hideAllMenus();
            if (contextIconIdx >= 0) {
                showInputDialog(t('rename'), desktopIcons[contextIconIdx].name, name => {
                    if (name) {
                        desktopIcons[contextIconIdx].name = name;
                        renderDesktopIcons();
                    }
                });
            }
        }

        function ctxDeleteIcon() {
            hideAllMenus();
            let sel = getSelectedIndices();
            if (sel.length === 0 && contextIconIdx >= 0) sel = [contextIconIdx];

            sel.sort((a, b) => b - a).forEach(i => {
                const icon = desktopIcons[i];
                if (['icon-pc', 'icon-recycle'].includes(icon.id)) return;
                recycleBin.push({ ...icon, from: 'desktop' });
                desktopIcons.splice(i, 1);
            });
            renderDesktopIcons();
            showNotification(t('delete'), 'OK');
        }

        function getSelectedIndices() {
            const indices = [];
            document.querySelectorAll('.desktop-icon.selected').forEach(el => {
                indices.push(parseInt(el.dataset.index));
            });
            return indices;
        }

        // ==================== INPUT DIALOG ====================
        let dialogCallback = null;

        function showInputDialog(title, defaultVal, cb) {
            document.getElementById('dialog-title').textContent = title;
            document.getElementById('dialog-input').value = defaultVal;
            document.getElementById('dialog-overlay').style.display = 'block';
            document.getElementById('input-dialog').style.display = 'block';
            document.getElementById('dialog-input').focus();
            document.getElementById('dialog-input').select();
            dialogCallback = cb;
        }

        function closeDialog() {
            document.getElementById('dialog-overlay').style.display = 'none';
            document.getElementById('input-dialog').style.display = 'none';
        }

        function confirmDialog() {
            const val = document.getElementById('dialog-input').value;
            closeDialog();
            if (dialogCallback) dialogCallback(val);
        }

        document.getElementById('dialog-input')?.addEventListener('keydown', e => {
            if (e.key === 'Enter') confirmDialog();
            if (e.key === 'Escape') closeDialog();
        });

        // ==================== RECYCLE BIN ====================
        function renderRecycleBin() {
            const content = document.getElementById('recycle-content');
            content.innerHTML = recycleBin.length === 0 
                ? `<div class="explorer-empty">${t('recycle_bin').replace(' ', '')} empty</div>`
                : '';

            recycleBin.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = 'recycle-item';
                el.dataset.index = idx;
                el.innerHTML = `<div class="item-icon">${item.icon}</div><div class="item-name">${item.name}</div>`;
                el.onclick = () => {
                    el.classList.toggle('selected');
                    updateRecycleButtons();
                };
                content.appendChild(el);
            });
            updateRecycleButtons();
        }

        function updateRecycleButtons() {
            const sel = document.querySelectorAll('.recycle-item.selected').length;
            document.getElementById('restore-btn').disabled = sel === 0;
            document.getElementById('delete-btn').disabled = sel === 0;
        }

        function restoreSelected() {
            const items = document.querySelectorAll('.recycle-item.selected');
            const indices = Array.from(items).map(el => parseInt(el.dataset.index)).sort((a, b) => b - a);
            indices.forEach(i => {
                const item = recycleBin[i];
                desktopIcons.push(item);
                recycleBin.splice(i, 1);
            });
            renderDesktopIcons();
            renderRecycleBin();
        }

        function deleteForever() {
            const items = document.querySelectorAll('.recycle-item.selected');
            const indices = Array.from(items).map(el => parseInt(el.dataset.index)).sort((a, b) => b - a);
            indices.forEach(i => recycleBin.splice(i, 1));
            renderRecycleBin();
        }

        function emptyRecycleBin() {
            if (recycleBin.length && confirm(t('empty_bin') + '?')) {
                recycleBin = [];
                renderRecycleBin();
            }
        }

        // ==================== WINDOWS ====================
        let windowZ = 100;
        let dragWin = null, dragOffset = { x: 0, y: 0 };
        let resizeWin = null, resizeStart = {};

        function openWindow(id) {
            const win = document.getElementById(id + '-window');
            if (!win) return;
            win.style.display = 'flex';
            bringToFront(win);
            closeStartMenu();

            const tb = document.getElementById('tb-' + id);
            if (tb) tb.classList.add('active');

            if (id === 'explorer') { navigateExplorer('desktop'); }
            if (id === 'recycle') { renderRecycleBin(); }
            if (id === 'browser') { initBrowser(); }
            if (id === 'settings') { 
                document.getElementById('settings-username').value = state.username;
                initWallpaperGrid();
            }
        }

        function closeWindow(id) {
            document.getElementById(id + '-window').style.display = 'none';
            const tb = document.getElementById('tb-' + id);
            if (tb) tb.classList.remove('active');
            if (id === 'player' && mediaElement) {
                mediaElement.pause();
                isPlaying = false;
            }
        }

        function minimizeWindow(id) {
            document.getElementById(id + '-window').style.display = 'none';
        }

        function maximizeWindow(id) {
            const win = document.getElementById(id + '-window');
            if (win.dataset.max === 'true') {
                win.style.top = win.dataset.pt;
                win.style.left = win.dataset.pl;
                win.style.width = win.dataset.pw;
                win.style.height = win.dataset.ph;
                win.style.borderRadius = '10px';
                win.dataset.max = 'false';
            } else {
                win.dataset.pt = win.style.top || win.offsetTop + 'px';
                win.dataset.pl = win.style.left || win.offsetLeft + 'px';
                win.dataset.pw = win.style.width || win.offsetWidth + 'px';
                win.dataset.ph = win.style.height || win.offsetHeight + 'px';
                win.style.top = '0';
                win.style.left = '0';
                win.style.width = '100%';
                win.style.height = 'calc(100% - 52px)';
                win.style.borderRadius = '0';
                win.dataset.max = 'true';
            }
        }

        function bringToFront(win) {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            win.classList.add('active');
            win.style.zIndex = ++windowZ;
        }

        function openApp(id) {
            closeStartMenu();
            openWindow(id);
        }

        // Window dragging
        document.querySelectorAll('.window-header').forEach(header => {
            header.addEventListener('mousedown', function(e) {
                if (e.target.closest('.window-control')) return;
                const win = this.closest('.window');
                if (win.dataset.max === 'true') return;
                dragWin = win;
                bringToFront(win);
                dragOffset = { x: e.clientX - win.offsetLeft, y: e.clientY - win.offsetTop };
                e.preventDefault();
            });
        });

        document.querySelectorAll('.window-resize').forEach(handle => {
            handle.addEventListener('mousedown', function(e) {
                const win = this.closest('.window');
                if (win.dataset.max === 'true') return;
                resizeWin = win;
                resizeStart = { x: e.clientX, y: e.clientY, w: win.offsetWidth, h: win.offsetHeight };
                e.preventDefault();
            });
        });

        document.addEventListener('mousemove', function(e) {
            if (dragWin) {
                dragWin.style.left = (e.clientX - dragOffset.x) + 'px';
                dragWin.style.top = Math.max(0, e.clientY - dragOffset.y) + 'px';
            }
            if (resizeWin) {
                resizeWin.style.width = Math.max(280, resizeStart.w + e.clientX - resizeStart.x) + 'px';
                resizeWin.style.height = Math.max(180, resizeStart.h + e.clientY - resizeStart.y) + 'px';
            }
        });

        document.addEventListener('mouseup', () => { dragWin = null; resizeWin = null; });

        // ==================== BROWSER ====================
        let browserTabs = [];
        let activeTabId = 0;
        let tabIdCounter = 0;

        function initBrowser() {
            if (browserTabs.length === 0) {
                browserTabs.push({ id: tabIdCounter++, url: '', title: 'New Tab', history: [], histIdx: -1 });
                activeTabId = 0;
            }
            renderBrowserTabs();
            loadBrowserTab(activeTabId);
        }

        function renderBrowserTabs() {
            const container = document.getElementById('browser-tabs');
            container.innerHTML = '';
            browserTabs.forEach(tab => {
                const div = document.createElement('div');
                div.className = 'browser-tab' + (tab.id === activeTabId ? ' active' : '');
                div.innerHTML = `
                    <span></span>
                    <span class="browser-tab-title">${tab.title}</span>
                    <span class="browser-tab-close" onclick="closeBrowserTab(${tab.id}, event)"></span>
                `;
                div.onclick = () => { activeTabId = tab.id; loadBrowserTab(tab.id); renderBrowserTabs(); };
                container.appendChild(div);
            });
            container.innerHTML += '<div class="browser-new-tab" onclick="newBrowserTab()">+</div>';
        }

        function newBrowserTab() {
            const tab = { id: tabIdCounter++, url: '', title: 'New Tab', history: [], histIdx: -1 };
            browserTabs.push(tab);
            activeTabId = tab.id;
            renderBrowserTabs();
            loadBrowserTab(tab.id);
        }

        function closeBrowserTab(id, e) {
            e?.stopPropagation();
            if (browserTabs.length === 1) { closeWindow('browser'); return; }
            const idx = browserTabs.findIndex(t => t.id === id);
            browserTabs.splice(idx, 1);
            if (activeTabId === id) {
                activeTabId = browserTabs[Math.min(idx, browserTabs.length - 1)].id;
                loadBrowserTab(activeTabId);
            }
            renderBrowserTabs();
        }

        function loadBrowserTab(id) {
            const tab = browserTabs.find(t => t.id === id);
            document.getElementById('browser-url').value = tab.url || '';
            updateBrowserNav(tab);

            const view = document.getElementById('browser-view');
            if (!tab.url) {
                view.innerHTML = `
                    <div class="browser-home">
                        <div class="browser-logo">Microsoft Edge</div>
                        <div class="browser-search-box">
                            <input type="text" id="browser-search" placeholder="Search..." onkeydown="if(event.key==='Enter')searchWeb()">
                            <button onclick="searchWeb()"></button>
                        </div>
                        <div class="browser-shortcuts">
                            <div class="browser-shortcut" onclick="goToSite('https://google.com')"><div class="browser-shortcut-icon"></div><span>Google</span></div>
                            <div class="browser-shortcut" onclick="goToSite('https://youtube.com')"><div class="browser-shortcut-icon" style="background:#f00"></div><span>YouTube</span></div>
                            <div class="browser-shortcut" onclick="goToSite('https://github.com')"><div class="browser-shortcut-icon" style="background:#333"></div><span>GitHub</span></div>
                        </div>
                    </div>
                `;
            } else {
                view.innerHTML = `<iframe class="browser-iframe" src="${tab.url}"></iframe>`;
            }
        }

        function goToSite(url) {
            const tab = browserTabs.find(t => t.id === activeTabId);
            if (tab.histIdx < tab.history.length - 1) tab.history = tab.history.slice(0, tab.histIdx + 1);
            tab.history.push(url);
            tab.histIdx = tab.history.length - 1;
            tab.url = url;
            try { tab.title = new URL(url).hostname; } catch { tab.title = url; }
            loadBrowserTab(activeTabId);
            renderBrowserTabs();
        }

        function navigateUrl() {
            let url = document.getElementById('browser-url').value.trim();
            if (!url) return;
            if (!url.startsWith('http')) url = url.includes('.') ? 'https://' + url : 'https://bing.com/search?q=' + encodeURIComponent(url);
            goToSite(url);
        }

        function searchWeb() {
            const q = document.getElementById('browser-search')?.value;
            if (q) goToSite('https://bing.com/search?q=' + encodeURIComponent(q));
        }

        function browserBack() {
            const tab = browserTabs.find(t => t.id === activeTabId);
            if (tab.histIdx > 0) {
                tab.histIdx--;
                tab.url = tab.history[tab.histIdx];
                loadBrowserTab(activeTabId);
                renderBrowserTabs();
            }
        }

        function browserForward() {
            const tab = browserTabs.find(t => t.id === activeTabId);
            if (tab.histIdx < tab.history.length - 1) {
                tab.histIdx++;
                tab.url = tab.history[tab.histIdx];
                loadBrowserTab(activeTabId);
                renderBrowserTabs();
            }
        }

        function browserRefresh() { loadBrowserTab(activeTabId); }

        function browserHome() {
            const tab = browserTabs.find(t => t.id === activeTabId);
            tab.url = '';
            tab.title = 'New Tab';
            loadBrowserTab(activeTabId);
            renderBrowserTabs();
        }

        function updateBrowserNav(tab) {
            document.getElementById('browser-back').disabled = tab.histIdx <= 0;
            document.getElementById('browser-forward').disabled = tab.histIdx >= tab.history.length - 1;
        }

        // ==================== EXPLORER ====================
        let expPath = 'desktop';
        let expHistory = ['desktop'];
        let expHistIdx = 0;

        function navigateExplorer(path) {
            const parent = path.split('/')[0];
            if (parent === 'C:' && path !== 'C:') {
                showNotification(t('access_denied'), t('system_folder'));
                return;
            }

            expPath = path;
            if (expHistIdx < expHistory.length - 1) expHistory = expHistory.slice(0, expHistIdx + 1);
            expHistory.push(path);
            expHistIdx = expHistory.
			length - 1;
            renderExplorer();
        }

        function renderExplorer() {
            const content = document.getElementById('explorer-content');
            const pathNames = {
                'desktop': t('desktop'),
                'downloads': t('downloads'),
                'documents': t('documents'),
                'pictures': t('pictures'),
                'music': t('music'),
                'videos': t('videos'),
                'C:': t('this_pc') + ' (C:)'
            };

            document.getElementById('explorer-path').value = pathNames[expPath] || expPath;
            document.getElementById('exp-back').disabled = expHistIdx <= 0;
            document.getElementById('exp-forward').disabled = expHistIdx >= expHistory.length - 1;

            const files = fileSystem[expPath] || [];

            if (files.length === 0) {
                content.innerHTML = `<div class="explorer-empty">${t('items').replace(/\d+/, '0')}</div>`;
            } else {
                content.innerHTML = '<div class="explorer-grid" id="explorer-grid"></div>';
                const grid = document.getElementById('explorer-grid');
                
                files.forEach((file, idx) => {
                    const el = document.createElement('div');
                    el.className = 'explorer-item' + (file.locked ? ' locked' : '');
                    el.innerHTML = `
                        <div class="item-icon">${file.icon}</div>
                        <div class="item-name">${file.name}</div>
                        ${file.locked ? '<span class="lock-icon"></span>' : ''}
                    `;

                    if (!file.locked) {
                        el.ondblclick = () => {
                            if (file.type === 'folder') {
                                navigateExplorer(file.path || expPath + '/' + file.name.toLowerCase().replace(/\s+/g, '_'));
                            } else if (file.name.endsWith('.mp3') || file.name.endsWith('.mp4')) {
                                openWindow('player');
                            } else if (file.name.endsWith('.txt')) {
                                openWindow('notepad');
                                document.getElementById('notepad-text').value = file.content || '';
                                document.getElementById('notepad-title').textContent = ' ' + file.name;
                            }
                        };
                    } else {
                        el.ondblclick = () => showNotification(t('access_denied'), t('system_folder'));
                    }

                    el.onclick = () => {
                        grid.querySelectorAll('.explorer-item').forEach(i => i.classList.remove('selected'));
                        el.classList.add('selected');
                    };

                    grid.appendChild(el);
                });
            }

            document.getElementById('explorer-status').textContent = files.length + ' ' + t('items');

            // Update sidebar active state
            document.querySelectorAll('.explorer-sidebar-item').forEach(el => {
                el.classList.remove('active');
            });
        }

        function explorerBack() {
            if (expHistIdx > 0) {
                expHistIdx--;
                expPath = expHistory[expHistIdx];
                renderExplorer();
            }
        }

        function explorerForward() {
            if (expHistIdx < expHistory.length - 1) {
                expHistIdx++;
                expPath = expHistory[expHistIdx];
                renderExplorer();
            }
        }

        function explorerUp() {
            if (expPath.includes('/')) {
                navigateExplorer(expPath.split('/').slice(0, -1).join('/') || 'desktop');
            } else if (expPath !== 'desktop') {
                navigateExplorer('desktop');
            }
        }

        // ==================== MEDIA PLAYER ====================
        let mediaElement = null;
        let isPlaying = false;

        function initPlayer() {
            const display = document.getElementById('player-display');
            const dropzone = document.getElementById('player-dropzone');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
                display.addEventListener(event, e => e.preventDefault());
            });

            display.addEventListener('dragenter', () => dropzone?.classList.add('dragover'));
            display.addEventListener('dragleave', () => dropzone?.classList.remove('dragover'));
            display.addEventListener('drop', handleMediaDrop);
        }

        function handleMediaDrop(e) {
            const dropzone = document.getElementById('player-dropzone');
            dropzone?.classList.remove('dragover');

            const file = e.dataTransfer.files[0];
            if (!file) return;

            const validTypes = ['audio/mpeg', 'audio/mp3', 'audio/ogg', 'video/mp4', 'video/webm', 'video/ogg'];
            if (!validTypes.includes(file.type) && !file.name.match(/\.(mp3|mp4|webm|ogg)$/i)) {
                showNotification('Error', 'Unsupported format');
                return;
            }

            loadMediaFile(file);
        }

        function loadMediaFile(file) {
            const display = document.getElementById('player-display');
            const url = URL.createObjectURL(file);
            const isVideo = file.type.startsWith('video/') || file.name.match(/\.(mp4|webm)$/i);

            if (mediaElement) {
                mediaElement.pause();
                mediaElement.remove();
            }

            mediaElement = document.createElement(isVideo ? 'video' : 'audio');
            mediaElement.src = url;
            mediaElement.style.maxWidth = '100%';
            mediaElement.style.maxHeight = '100%';

            display.innerHTML = '';
            display.appendChild(mediaElement);

            if (!isVideo) {
                const info = document.createElement('div');
                info.style.cssText = 'position: absolute; text-align: center; color: #fff;';
                info.innerHTML = `<div style="font-size: 70px; margin-bottom: 15px;"></div><div style="font-size: 16px;">${file.name}</div>`;
                display.appendChild(info);
            }

            document.getElementById('player-title').textContent = file.name;

            mediaElement.onloadedmetadata = () => {
                document.getElementById('player-duration').textContent = formatTime(mediaElement.duration);
            };

            mediaElement.ontimeupdate = () => {
                const progress = (mediaElement.currentTime / mediaElement.duration) * 100;
                document.getElementById('player-progress').style.width = progress + '%';
                document.getElementById('player-current').textContent = formatTime(mediaElement.currentTime);
            };

            mediaElement.onended = () => {
                isPlaying = false;
                document.getElementById('play-btn').textContent = '';
            };

            togglePlay();
        }

        function togglePlay() {
            if (!mediaElement) return;

            if (isPlaying) {
                mediaElement.pause();
                document.getElementById('play-btn').textContent = '';
            } else {
                mediaElement.play();
                document.getElementById('play-btn').textContent = '';
            }
            isPlaying = !isPlaying;
        }

        function seekPlayer(e) {
            if (!mediaElement) return;
            const rect = e.currentTarget.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            mediaElement.currentTime = percent * mediaElement.duration;
        }

        function setVolume(value) {
            if (mediaElement) mediaElement.volume = value / 100;
        }

        function playerPrev() {
            if (mediaElement) mediaElement.currentTime = 0;
        }

        function playerNext() {
            if (mediaElement) mediaElement.currentTime = mediaElement.duration;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        // ==================== CALCULATOR ====================
        let calcDisplay = '0';
        let calcExpr = '';
        let calcNewNum = true;

        function calcNum(n) {
            if (calcNewNum) {
                calcDisplay = n === '.' ? '0.' : n;
                calcNewNum = false;
            } else {
                if (n === '.' && calcDisplay.includes('.')) return;
                calcDisplay += n;
            }
            document.getElementById('calc-result').textContent = calcDisplay;
        }

        function calcOp(op) {
            calcExpr += calcDisplay + ' ' + op + ' ';
            document.getElementById('calc-expr').textContent = calcExpr;
            calcNewNum = true;
        }

        function calcEquals() {
            try {
                const result = eval(calcExpr + calcDisplay);
                document.getElementById('calc-expr').textContent = calcExpr + calcDisplay + ' =';
                calcDisplay = String(Math.round(result * 1000000) / 1000000);
                document.getElementById('calc-result').textContent = calcDisplay;
                calcExpr = '';
                calcNewNum = true;
            } catch (e) {
                document.getElementById('calc-result').textContent = 'Error';
                calcClear();
            }
        }

        function calcClear() {
            calcDisplay = '0';
            calcExpr = '';
            calcNewNum = true;
            document.getElementById('calc-result').textContent = '0';
            document.getElementById('calc-expr').textContent = '';
        }

        function calcClearEntry() {
            calcDisplay = '0';
            calcNewNum = true;
            document.getElementById('calc-result').textContent = '0';
        }

        function calcBackspace() {
            if (calcDisplay.length > 1) {
                calcDisplay = calcDisplay.slice(0, -1);
            } else {
                calcDisplay = '0';
                calcNewNum = true;
            }
            document.getElementById('calc-result').textContent = calcDisplay;
        }

        function calcNegate() {
            if (calcDisplay !== '0') {
                calcDisplay = calcDisplay.startsWith('-') ? calcDisplay.slice(1) : '-' + calcDisplay;
                document.getElementById('calc-result').textContent = calcDisplay;
            }
        }

        // ==================== NOTEPAD ====================
        document.getElementById('notepad-text')?.addEventListener('input', function() {
            const text = this.value;
            const lines = text.substr(0, this.selectionStart).split('\n');
            document.getElementById('notepad-status').textContent = `Ln ${lines.length}, Col ${lines[lines.length - 1].length + 1}`;
        });

        // ==================== SETTINGS ====================
        function showSettingsTab(tab, el) {
            document.querySelectorAll('.settings-nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');

            ['account', 'personalization', 'language', 'about'].forEach(t => {
                const section = document.getElementById('settings-' + t);
                if (section) section.style.display = t === tab ? 'block' : 'none';
            });

            if (tab === 'personalization') {
                initWallpaperGrid();
            }
        }

        function saveUsername() {
            const newName = document.getElementById('settings-username').value;
            if (newName) {
                state.username = newName;
                saveState();
                updateUserUI();
                showNotification(t('save'), 'OK');
            }
        }

        function changePassword() {
            const current = prompt(state.language === 'ru' ? ' :' : 'Current password:');
            if (current !== state.password) {
                showNotification('Error', t('wrong_password'));
                return;
            }
            const newPass = prompt(state.language === 'ru' ? ' :' : 'New password:');
            if (newPass) {
                state.password = newPass;
                saveState();
                showNotification(t('save'), 'OK');
            }
        }

        // ==================== NOTIFICATIONS ====================
        function showNotification(title, body) {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const note = document.createElement('div');
            note.className = 'notification';
            note.innerHTML = `
                <div class="notification-header">
                    <h4>${title}</h4>
                    <span class="notification-close" onclick="this.parentElement.parentElement.remove()"></span>
                </div>
                <div class="notification-body">${body}</div>
            `;
            document.body.appendChild(note);
            setTimeout(() => note.remove(), 3500);
        }

        // ==================== SHUTDOWN ====================
        function shutdownPC() {
            closeStartMenu();
            document.getElementById('desktop').style.display = 'none';
            document.getElementById('boot-screen').style.display = 'flex';
            document.querySelector('.boot-hint').textContent = state.language === 'ru' ? '...' : 'Shutting down...';
            document.querySelector('.boot-loader').style.display = 'none';

            setTimeout(() => {
                document.getElementById('boot-screen').innerHTML = `
                    <div style="color: #fff; font-size: 22px; margin-bottom: 25px;">${state.language === 'ru' ? ' ' : 'PC is off'}</div>
                    <button onclick="location.reload()" style="padding: 12px 28px; font-size: 15px; background: #0078d4; color: #fff; border: none; border-radius: 8px; cursor: pointer;">
                        ${state.language === 'ru' ? '' : 'Turn on'}
                    </button>
                `;
            }, 1500);
        }

        // ==================== KEYBOARD SHORTCUTS ====================
        document.addEventListener('keydown', function(e) {
            // F5 - Refresh desktop
            if (e.key === 'F5' && document.getElementById('desktop').style.display !== 'none') {
                e.preventDefault();
                ctxRefresh();
            }

            // Delete - Delete selected icons
            if (e.key === 'Delete') {
                const sel = getSelectedIndices();
                if (sel.length > 0) {
                    ctxDeleteIcon();
                }
            }

            // F2 - Rename
            if (e.key === 'F2') {
                const sel = getSelectedIndices();
                if (sel.length === 1) {
                    contextIconIdx = sel[0];
                    ctxRenameIcon();
                }
            }

            // Ctrl+C - Copy
            if (e.ctrlKey && e.key === 'c') {
                const sel = getSelectedIndices();
                if (sel.length > 0) {
                    clipboard = sel.map(i => ({ ...desktopIcons[i] }));
                    clipboardAction = 'copy';
                    showNotification(t('copy'), sel.length + ' ' + t('items'));
                }
            }

            // Ctrl+X - Cut
            if (e.ctrlKey && e.key === 'x') {
                const sel = getSelectedIndices();
                if (sel.length > 0) {
                    clipboard = sel.map(i => ({ ...desktopIcons[i] }));
                    clipboardAction = 'cut';
                    showNotification(t('cut'), sel.length + ' ' + t('items'));
                }
            }

            // Ctrl+V - Paste
            if (e.ctrlKey && e.key === 'v' && clipboard) {
                ctxPaste();
            }

            // Escape - Clear selection / Close menus
            if (e.key === 'Escape') {
                clearIconSelection();
                hideAllMenus();
                closeStartMenu();
            }
        });

        // ==================== EXPLORER CONTEXT MENU ====================
        document.getElementById('explorer-content')?.addEventListener('contextmenu', function(e) {
            if (e.target.closest('.explorer-item')) return;
            e.preventDefault();
            
            contextClickPos = { x: e.clientX, y: e.clientY };
            hideAllMenus();
            
            const menu = document.getElementById('context-menu');
            menu.style.display = 'block';
            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
        });

        // Create folder/file in explorer
        function ctxNewFolderInExplorer() {
            hideAllMenus();
            showInputDialog(t('new_folder'), t('new_folder'), name => {
                if (name && fileSystem[expPath]) {
                    const newPath = expPath + '/' + name.toLowerCase().replace(/\s+/g, '_');
                    fileSystem[expPath].push({
                        name: name,
                        icon: '',
                        type: 'folder',
                        path: newPath
                    });
                    fileSystem[newPath] = [];
                    renderExplorer();
                }
            });
        }

        function ctxNewFileInExplorer() {
            hideAllMenus();
            showInputDialog(t('new_document'), 'Document.txt', name => {
                if (name && fileSystem[expPath]) {
                    fileSystem[expPath].push({
                        name: name,
                        icon: '',
                        type: 'file',
                        content: ''
                    });
                    renderExplorer();
                }
            });
        }

        // ==================== MATRIX ANIMATION ====================
        function initMatrix(container) {
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let i = 0; i < 30; i++) {
                const column = document.createElement('div');
                column.className = 'matrix-column';
                column.style.left = (i * 3.3) + '%';
                column.style.animationDelay = (Math.random() * 10) + 's';
                column.style.animationDuration = (8 + Math.random() * 8) + 's';
                
                let text = '';
                for (let j = 0; j < 30; j++) {
                    text += chars[Math.floor(Math.random() * chars.length)] + '<br>';
                }
                column.innerHTML = text;
                container.appendChild(column);
            }
        }

        // ==================== DRAG FILES TO DESKTOP ====================
        document.getElementById('desktop-area')?.addEventListener('dragover', e => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        });

        document.getElementById('desktop-area')?.addEventListener('drop', function(e) {
            e.preventDefault();
            const files = e.dataTransfer.files;
            
            if (files.length === 0) return;

            const x = e.clientX;
            const y = e.clientY;

            Array.from(files).forEach((file, idx) => {
                let icon = '';
                let action = null;

                if (file.type.startsWith('image/')) icon = '';
                else if (file.type.startsWith('video/')) { icon = ''; action = 'player'; }
                else if (file.type.startsWith('audio/')) { icon = ''; action = 'player'; }
                else if (file.name.endsWith('.txt')) icon = '';
                else if (file.name.endsWith('.pdf')) icon = '';
                else if (file.name.endsWith('.zip') || file.name.endsWith('.rar')) icon = '';

                // Store file content for media files
                const reader = new FileReader();
                reader.onload = ev => {
                    const newIcon = {
                        id: 'file-' + Date.now() + '-' + idx,
                        name: file.name,
                        icon: icon,
                        type: 'file',
                        x: x + (idx * 20),
                        y: y + (idx * 20),
                        action: action,
                        fileData: ev.target.result,
                        fileType: file.type
                    };
                    desktopIcons.push(newIcon);
                    renderDesktopIcons();
                };

                if (file.type.startsWith('audio/') || file.type.startsWith('video/')) {
                    reader.readAsDataURL(file);
                } else {
                    const newIcon = {
                        id: 'file-' + Date.now() + '-' + idx,
                        name: file.name,
                        icon: icon,
                        type: 'file',
                        x: x + (idx * 20),
                        y: y + (idx * 20)
                    };
                    desktopIcons.push(newIcon);
                    renderDesktopIcons();
                }
            });

            showNotification(t('desktop'), files.length + ' ' + t('items') + ' added');
        });

        // Open media files from desktop
        function openIconAction(icon) {
            if (icon.action === 'player' && icon.fileData) {
                openWindow('player');
                setTimeout(() => {
                    loadMediaFromData(icon.fileData, icon.fileType, icon.name);
                }, 100);
            } else if (icon.action) {
                openWindow(icon.action);
            } else if (icon.type === 'folder') {
                openWindow('explorer');
                setTimeout(() => navigateExplorer(icon.path || 'desktop'), 100);
            } else if (icon.type === 'file' && icon.name.endsWith('.txt')) {
                openWindow('notepad');
                document.getElementById('notepad-text').value = icon.content || '';
                document.getElementById('notepad-title').textContent = ' ' + icon.name;
            }
        }

        function loadMediaFromData(data, type, name) {
            const display = document.getElementById('player-display');
            const isVideo = type.startsWith('video/');

            if (mediaElement) {
                mediaElement.pause();
                mediaElement.remove();
            }

            mediaElement = document.createElement(isVideo ? 'video' : 'audio');
            mediaElement.src = data;
            mediaElement.style.maxWidth = '100%';
            mediaElement.style.maxHeight = '100%';

            display.innerHTML = '';
            display.appendChild(mediaElement);

            if (!isVideo) {
                const info = document.createElement('div');
                info.style.cssText = 'position: absolute; text-align: center; color: #fff;';
                info.innerHTML = `<div style="font-size: 70px; margin-bottom: 15px;"></div><div style="font-size: 16px;">${name}</div>`;
                display.appendChild(info);
            }

            document.getElementById('player-title').textContent = name;

            mediaElement.onloadedmetadata = () => {
                document.getElementById('player-duration').textContent = formatTime(mediaElement.duration);
            };

            mediaElement.ontimeupdate = () => {
                const progress = (mediaElement.currentTime / mediaElement.duration) * 100;
                document.getElementById('player-progress').style.width = progress + '%';
                document.getElementById('player-current').textContent = formatTime(mediaElement.currentTime);
            };

            mediaElement.onended = () => {
                isPlaying = false;
                document.getElementById('play-btn').textContent = '';
            };

            togglePlay();
        }

        // ==================== TOUCH SUPPORT (BASIC) ====================
        let touchStartTime = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartTime = Date.now();
        });

        document.addEventListener('touchend', function(e) {
            const touchDuration = Date.now() - touchStartTime;
            
            // Long press = right click
            if (touchDuration > 500) {
                const touch = e.changedTouches[0];
                const event = new MouseEvent('contextmenu', {
                    bubbles: true,
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                e.target.dispatchEvent(event);
            }
        });

        // ==================== AUTO SAVE ====================
        setInterval(() => {
            if (state.setupDone) {
                saveState();
                localStorage.setItem('desktopIcons', JSON.stringify(desktopIcons));
                localStorage.setItem('fileSystem', JSON.stringify(fileSystem));
            }
        }, 30000);

        // Load file system
        function loadFileSystem() {
            const saved = localStorage.getItem('fileSystem');
            if (saved) {
                const parsed = JSON.parse(saved);
                fileSystem = { ...fileSystem, ...parsed };
            }
        }

        // ==================== STARTUP ====================
        window.onload = function() {
            loadFileSystem();
            init();
        };
    </script>
</body>
</html>